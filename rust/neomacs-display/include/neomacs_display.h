/* Auto-generated by cbindgen. Do not edit. */
/* Neomacs Display Engine C FFI */


#ifndef NEOMACS_DISPLAY_H
#define NEOMACS_DISPLAY_H

/* Warning: this file was auto-generated by cbindgen. */

#include <stdarg.h>
#include <stdbool.h>
#include <stdint.h>
#include <stdlib.h>
/**
 * Modifier flags matching Emacs.
 */
#define NEOMACS_SHIFT_MASK (1 << 0)

#define NEOMACS_CTRL_MASK (1 << 1)

#define NEOMACS_META_MASK (1 << 2)

#define NEOMACS_SUPER_MASK (1 << 3)

/**
 * Event kinds for NeomacsInputEvent.kind
 */
#define NEOMACS_EVENT_KEY_PRESS     1
#define NEOMACS_EVENT_KEY_RELEASE   2
#define NEOMACS_EVENT_MOUSE_PRESS   3
#define NEOMACS_EVENT_MOUSE_RELEASE 4
#define NEOMACS_EVENT_MOUSE_MOVE    5
#define NEOMACS_EVENT_SCROLL        6
#define NEOMACS_EVENT_RESIZE        7
#define NEOMACS_EVENT_CLOSE_REQUEST 8
#define NEOMACS_EVENT_FOCUS_IN      9
#define NEOMACS_EVENT_FOCUS_OUT     10

#define DRM_FORMAT_ARGB8888 875713089

#define DRM_FORMAT_XRGB8888 875713112

#define DRM_FORMAT_ABGR8888 875708993

#define DRM_FORMAT_XBGR8888 875709016


/**
 * Number of defined scroll effects.
 */
#define ScrollEffect_COUNT 21

/**
 * Modifier flags matching Emacs.
 */
#define NEOMACS_SHIFT_MASK (1 << 0)

#define NEOMACS_CTRL_MASK (1 << 1)

#define NEOMACS_META_MASK (1 << 2)

#define NEOMACS_SUPER_MASK (1 << 3)































/**
 * Maximum number of DMA-BUF planes supported.
 */
#define MAX_PLANES 4

#define DRM_FORMAT_ARGB8888 875713089

#define DRM_FORMAT_ARGB8888 875713089

#define DRM_FORMAT_XRGB8888 875713112

#define DRM_FORMAT_XRGB8888 875713112

#define DRM_FORMAT_ABGR8888 875708993

#define DRM_FORMAT_ABGR8888 875708993

#define DRM_FORMAT_XBGR8888 875709016

#define DRM_FORMAT_XBGR8888 875709016

#define DRM_FORMAT_RGBA8888 875708754

#define DRM_FORMAT_RGBX8888 875714642

#define DRM_FORMAT_BGRA8888 875708738

#define DRM_FORMAT_BGRX8888 875714626

#define DRM_FORMAT_NV12 842094158

#define DRM_FORMAT_YUV420 842093913

/**
 * Linear modifier (no tiling)
 */
#define DRM_FORMAT_MOD_LINEAR 0

/**
 * Invalid modifier
 */
#define DRM_FORMAT_MOD_INVALID 72057594037927935

#define VA_EXPORT_SURFACE_READ_ONLY 1

#define VA_EXPORT_SURFACE_SEPARATE_LAYERS 4

#define VA_SURFACE_ATTRIB_MEM_TYPE_DRM_PRIME_2 1073741824

/**
 * Popup menu item passed from C.
 */
typedef struct CPopupMenuItem {
  const char *label;
  const char *shortcut;
  int enabled;
  int separator;
  int submenu;
  int depth;
} CPopupMenuItem;

/**
 * Type for the resize callback function pointer from C
 */
typedef void (*ResizeCallbackFn)(void *user_data, int width, int height);

/**
 * Type for mouse button callback
 */
typedef void (*MouseButtonCallbackFn)(void *user_data,
                                      double x,
                                      double y,
                                      unsigned int button,
                                      int pressed,
                                      unsigned int modifiers,
                                      unsigned int time);

/**
 * Type for mouse motion callback
 */
typedef void (*MouseMotionCallbackFn)(void *user_data,
                                      double x,
                                      double y,
                                      unsigned int modifiers,
                                      unsigned int time);

/**
 * Type for mouse scroll callback
 */
typedef void (*MouseScrollCallbackFn)(void *user_data,
                                      double x,
                                      double y,
                                      double delta_x,
                                      double delta_y,
                                      unsigned int modifiers,
                                      unsigned int time);

/**
 * Input event structure passed to C.
 */
typedef struct NeomacsInputEvent {
  uint32_t kind;
  uint32_t windowId;
  uint64_t timestamp;
  int32_t x;
  int32_t y;
  uint32_t keycode;
  uint32_t keysym;
  uint32_t modifiers;
  uint32_t button;
  float scrollDeltaX;
  float scrollDeltaY;
  uint32_t pixelPrecise;
  uint32_t width;
  uint32_t height;
} NeomacsInputEvent;

/**
 * Opaque pointer to an Emacs buffer (struct buffer *)
 */
typedef void *EmacsBuffer;

/**
 * Opaque pointer to an Emacs frame (struct frame *)
 */
typedef void *EmacsFrame;

/**
 * Opaque pointer to an Emacs window (struct window *)
 */
typedef void *EmacsWindow;

/**
 * FFI-safe window parameters struct.
 * Matches the C struct in neomacsterm.c.
 */
typedef struct WindowParamsFFI {
  /**
   * Window pointer as i64
   */
  int64_t windowId;
  /**
   * Buffer pointer as u64
   */
  uint64_t bufferId;
  /**
   * Window pointer (for FFI callbacks)
   */
  EmacsWindow windowPtr;
  /**
   * Buffer pointer (for FFI callbacks)
   */
  EmacsBuffer bufferPtr;
  /**
   * Frame-absolute position
   */
  float x;
  float y;
  float width;
  float height;
  /**
   * Text area bounds (excluding fringes, margins)
   */
  float textX;
  float textY;
  float textWidth;
  float textHeight;
  /**
   * Whether this is the selected window
   */
  int selected;
  /**
   * Whether this is the minibuffer window
   */
  int isMinibuffer;
  /**
   * First visible buffer position
   */
  int64_t windowStart;
  /**
   * Point position
   */
  int64_t point;
  /**
   * Buffer size (ZV)
   */
  int64_t bufferZv;
  /**
   * Buffer beginning (BEGV)
   */
  int64_t bufferBegv;
  /**
   * Horizontal scroll
   */
  int hscroll;
  /**
   * Truncate long lines
   */
  int truncateLines;
  /**
   * Word wrap at word boundaries
   */
  int wordWrap;
  /**
   * Tab width
   */
  int tabWidth;
  /**
   * Default face colors (sRGB pixels)
   */
  uint32_t defaultFg;
  uint32_t defaultBg;
  /**
   * Character cell dimensions
   */
  float charWidth;
  float charHeight;
  /**
   * Font pixel size
   */
  float fontPixelSize;
  /**
   * Font ascent
   */
  float fontAscent;
  /**
   * Special line heights
   */
  float modeLineHeight;
  float headerLineHeight;
  float tabLineHeight;
  /**
   * Cursor type and width
   */
  uint8_t cursorType;
  int cursorBarWidth;
  /**
   * Fringe widths in pixels
   */
  float leftFringeWidth;
  float rightFringeWidth;
  /**
   * indicate-empty-lines: 0=off, 1=left, 2=right
   */
  int indicateEmptyLines;
  /**
   * show-trailing-whitespace
   */
  int showTrailingWhitespace;
  /**
   * trailing-whitespace face background color (sRGB pixel)
   */
  uint32_t trailingWsBg;
  /**
   * fill-column-indicator column (0 = off)
   */
  int fillColumnIndicator;
  /**
   * fill-column-indicator character (0 = use default '|')
   */
  int fillColumnIndicatorChar;
  /**
   * fill-column-indicator face foreground (sRGB pixel)
   */
  uint32_t fillColumnIndicatorFg;
  /**
   * Extra line spacing in pixels
   */
  float extraLineSpacing;
  /**
   * Whether to show cursor in non-selected windows
   */
  int cursorInNonSelected;
  /**
   * selective-display: 0=off, >0=hide lines indented more than N columns
   */
  int selectiveDisplay;
  /**
   * escape-glyph face foreground color for control chars
   */
  uint32_t escapeGlyphFg;
  /**
   * nobreak-char-display: 0=off, 1=highlight, 2=escape notation
   */
  int nobreakCharDisplay;
  /**
   * nobreak-char face foreground color
   */
  uint32_t nobreakCharFg;
  /**
   * glyphless-char face foreground color
   */
  uint32_t glyphlessCharFg;
  /**
   * wrap-prefix: string rendered at start of continuation lines
   */
  uint8_t wrapPrefix[128];
  int wrapPrefixLen;
  /**
   * line-prefix: string rendered at start of all visual lines
   */
  uint8_t linePrefix[128];
  int linePrefixLen;
  /**
   * Margin widths in pixels
   */
  float leftMarginWidth;
  float rightMarginWidth;
  /**
   * Buffer file name (NULL if no file)
   */
  const char *bufferFileName;
  /**
   * Whether the buffer has unsaved modifications
   */
  int modified;
} WindowParamsFFI;

/**
 * FFI-safe face data struct.
 */
typedef struct FaceDataFFI {
  /**
   * Face ID
   */
  uint32_t faceId;
  /**
   * Foreground color (sRGB pixel: 0x00RRGGBB)
   */
  uint32_t fg;
  /**
   * Background color (sRGB pixel: 0x00RRGGBB)
   */
  uint32_t bg;
  /**
   * Font family name (null-terminated C string, valid for duration of layout)
   */
  const char *fontFamily;
  /**
   * Font weight (CSS scale: 400=normal, 700=bold)
   */
  int fontWeight;
  /**
   * Italic flag
   */
  int italic;
  /**
   * Font pixel size
   */
  int fontSize;
  /**
   * Underline style (0=none, 1=single, 2=wave, 3=double, 4=dotted, 5=dashed)
   */
  int underlineStyle;
  /**
   * Underline color (sRGB pixel)
   */
  uint32_t underlineColor;
  /**
   * Strike-through (0=none, 1=enabled)
   */
  int strikeThrough;
  /**
   * Strike-through color
   */
  uint32_t strikeThroughColor;
  /**
   * Overline (0=none, 1=enabled)
   */
  int overline;
  /**
   * Overline color
   */
  uint32_t overlineColor;
  /**
   * Box type (0=none, 1=line)
   */
  int boxType;
  /**
   * Box color
   */
  uint32_t boxColor;
  /**
   * Box line width
   */
  int boxLineWidth;
  /**
   * Extend: face bg extends to end of visual line (0=no, 1=yes)
   */
  int extend;
  /**
   * Per-face font character width (0.0 = use window default)
   */
  float fontCharWidth;
  /**
   * Per-face font ascent (0.0 = use window default)
   */
  float fontAscent;
} FaceDataFFI;

/**
 * FFI-safe line number configuration struct.
 * Matches the C struct LineNumberConfigFFI in neomacsterm.c.
 */
typedef struct LineNumberConfigFFI {
  /**
   * 0=off, 1=absolute, 2=relative, 3=visual
   */
  int mode;
  /**
   * Column width for line numbers (including padding)
   */
  int width;
  /**
   * display-line-numbers-offset
   */
  int offset;
  /**
   * display-line-numbers-major-tick
   */
  int majorTick;
  /**
   * display-line-numbers-minor-tick
   */
  int minorTick;
  /**
   * display-line-numbers-current-absolute
   */
  int currentAbsolute;
  /**
   * display-line-numbers-widen
   */
  int widen;
} LineNumberConfigFFI;

/**
 * FFI-safe display text property result.
 * Matches the C struct DisplayPropFFI in neomacsterm.c.
 */
typedef struct DisplayPropFFI {
  /**
   * 0=none, 1=string replacement, 2=space, 3=align-to, 4=image, 5=raise
   */
  int propType;
  /**
   * Bytes of replacement string (type=1)
   */
  int strLen;
  /**
   * Space width in columns (type=2)
   */
  float spaceWidth;
  /**
   * Space height in pixels (type=2), 0 = use default char_h
   */
  float spaceHeight;
  /**
   * Charpos where this display property region ends
   */
  int64_t coversTo;
  /**
   * Align-to column (type=3)
   */
  float alignTo;
  /**
   * GPU image ID (type=4)
   */
  uint32_t imageGpuId;
  /**
   * Image width in pixels (type=4)
   */
  int imageWidth;
  /**
   * Image height in pixels (type=4)
   */
  int imageHeight;
  /**
   * Image horizontal margin in pixels (type=4)
   */
  int imageHmargin;
  /**
   * Image vertical margin in pixels (type=4)
   */
  int imageVmargin;
  /**
   * Image ascent: 0-100 = percent, -1 = centered (type=4)
   */
  int imageAscent;
  /**
   * Raise factor (type=5), fraction of line height
   */
  float raiseFactor;
  /**
   * Display string face fg (type=1), 0=use position face
   */
  uint32_t displayFg;
  /**
   * Display string face bg (type=1), 0=use position face
   */
  uint32_t displayBg;
  /**
   * Fringe bitmap ID (type=6 left-fringe, type=7 right-fringe)
   */
  int fringeBitmapId;
  /**
   * Fringe face foreground color (type=6,7)
   */
  uint32_t fringeFg;
  /**
   * Fringe face background color (type=6,7)
   */
  uint32_t fringeBg;
  /**
   * Font height multiplier (type=5,8): 0.0=default, >0=scale factor
   */
  float heightFactor;
} DisplayPropFFI;

#define VA_STATUS_SUCCESS 0

#define VA_INVALID_SURFACE 4294967295

extern GMainContext *g_main_context_get_thread_default(void);

extern GMainContext *g_main_context_new(void);

extern GMainContext *g_main_context_ref(GMainContext *context);

extern void g_main_context_unref(GMainContext *context);

extern void g_main_context_push_thread_default(GMainContext *context);

extern void g_main_context_pop_thread_default(GMainContext *context);

extern int32_t g_main_context_acquire(GMainContext *context);

extern void g_main_context_release(GMainContext *context);

extern GObject *g_object_new(GType objectType, const char *firstPropertyName, ...);

/**
 * Shutdown the display engine
 *
 * # Safety
 * The handle must have been returned by neomacs_display_init_threaded.
 */
void neomacs_display_shutdown(struct NeomacsDisplay *handle);

/**
 * Resize the display
 */
void neomacs_display_resize(struct NeomacsDisplay *handle, int width, int height);

/**
 * Begin building a new frame
 */
void neomacs_display_begin_frame(struct NeomacsDisplay *handle);

/**
 * Add a window to the current frame
 */
void neomacs_display_add_window(struct NeomacsDisplay *handle,
                                int windowId,
                                float x,
                                float y,
                                float width,
                                float height,
                                uint32_t bgColor,
                                int selected);

/**
 * Add per-window metadata for animation detection
 */
void neomacs_display_add_window_info(struct NeomacsDisplay *handle,
                                     int64_t windowId,
                                     uint64_t bufferId,
                                     int64_t windowStart,
                                     int64_t windowEnd,
                                     int64_t bufferSize,
                                     float x,
                                     float y,
                                     float width,
                                     float height,
                                     float modeLineHeight,
                                     int selected,
                                     int isMinibuffer,
                                     float charHeight,
                                     const char *bufferFileName,
                                     int modified);

/**
 * Set cursor for a specific window
 */
void neomacs_display_set_cursor(struct NeomacsDisplay *handle,
                                int windowId,
                                float x,
                                float y,
                                float width,
                                float height,
                                int style,
                                uint32_t color,
                                int visible);

/**
 * Set inverse video info for a filled box cursor
 *
 * Called from C for style 0 (filled box) cursors. Provides the cursor
 * background color (the cursor rect) and cursor foreground color (for
 * redrawing the character under the cursor in inverse video).
 */
void neomacs_display_set_cursor_inverse(struct NeomacsDisplay *handle,
                                        float x,
                                        float y,
                                        float width,
                                        float height,
                                        uint32_t cursorBgRgba,
                                        uint32_t cursorFgRgba);

/**
 * Draw a border rectangle (for window dividers)
 */
void neomacs_display_draw_border(struct NeomacsDisplay *handle,
                                 int x,
                                 int y,
                                 int width,
                                 int height,
                                 uint32_t color);

/**
 * Add a GPU-rendered scroll bar
 */
void neomacs_display_add_scroll_bar(struct NeomacsDisplay *handle,
                                    int horizontal,
                                    int x,
                                    int y,
                                    int width,
                                    int height,
                                    int thumbStart,
                                    int thumbSize,
                                    uint32_t trackColor,
                                    uint32_t thumbColor);

/**
 * Begin a new glyph row for the current window
 */
void neomacs_display_begin_row(struct NeomacsDisplay *handle,
                               int y,
                               int x,
                               int height,
                               int ascent,
                               int modeLine,
                               int headerLine);

/**
 * Add a character glyph to the current row
 */
void neomacs_display_add_char_glyph(struct NeomacsDisplay *handle,
                                    uint32_t charcode,
                                    uint32_t faceId,
                                    int pixelWidth,
                                    int ascent,
                                    int descent);

/**
 * Add a stretch (whitespace) glyph to the current row
 */
void neomacs_display_add_stretch_glyph(struct NeomacsDisplay *handle,
                                       int pixelWidth,
                                       int height,
                                       uint32_t faceId);

/**
 * Add an image glyph to the current row
 */
void neomacs_display_add_image_glyph(struct NeomacsDisplay *handle,
                                     uint32_t imageId,
                                     int pixelWidth,
                                     int pixelHeight);

/**
 * End the current row
 */
void neomacs_display_end_row(struct NeomacsDisplay *handle);

/**
 * Register or update a face
 * Colors are in 0xRRGGBB format
 */
void neomacs_display_set_face(struct NeomacsDisplay *handle,
                              uint32_t faceId,
                              uint32_t foreground,
                              uint32_t background,
                              const char *fontFamily,
                              uint16_t fontWeight,
                              int isItalic,
                              int fontSize,
                              int underlineStyle,
                              uint32_t underlineColor,
                              int boxType,
                              uint32_t boxColor,
                              int boxLineWidth,
                              int boxCornerRadius,
                              int strikeThrough,
                              uint32_t strikeThroughColor,
                              int overline,
                              uint32_t overlineColor,
                              int fontAscent,
                              int fontDescent,
                              int ulPosition,
                              int ulThickness);

/**
 * Set the frame/scene background color
 * Color is in 0xRRGGBB format
 */
void neomacs_display_set_background(struct NeomacsDisplay *handle, uint32_t color);

/**
 * Set the frame/scene background alpha (for transparent backgrounds).
 * alpha is 0.0 (fully transparent) to 1.0 (fully opaque).
 */
void neomacs_display_set_background_alpha(struct NeomacsDisplay *handle, float alpha);

/**
 * Add a video glyph to the current row
 */
void neomacs_display_add_video_glyph(struct NeomacsDisplay *handle,
                                     uint32_t videoId,
                                     int pixelWidth,
                                     int pixelHeight);

/**
 * Load a video from file path (async - uses GStreamer)
 */
uint32_t neomacs_display_load_video(struct NeomacsDisplay *handle, const char *path);

/**
 * Play a loaded video
 */
int neomacs_display_video_play(struct NeomacsDisplay *handle, uint32_t videoId);

/**
 * Pause a video
 */
int neomacs_display_video_pause(struct NeomacsDisplay *handle, uint32_t videoId);

/**
 * Stop a video
 */
int neomacs_display_video_stop(struct NeomacsDisplay *handle, uint32_t videoId);

/**
 * Set video loop mode (-1 for infinite)
 */
int neomacs_display_video_set_loop(struct NeomacsDisplay *handle, uint32_t videoId, int loopCount);

/**
 * Process pending video frames (call each frame)
 */
int neomacs_display_video_update(struct NeomacsDisplay *handle, uint32_t videoId);

/**
 * Get video dimensions (works for pending and loaded videos)
 */
int neomacs_display_get_video_size(struct NeomacsDisplay *handle,
                                   uint32_t videoId,
                                   int *width,
                                   int *height);

/**
 * Load an image from a file path (delegates to load_image_file)
 */
uint32_t neomacs_display_load_image(struct NeomacsDisplay *handle, const char *path);

/**
 * Load an image from raw bytes (encoded image format)
 */
uint32_t neomacs_display_load_image_data(struct NeomacsDisplay *handle,
                                         const uint8_t *data,
                                         uintptr_t len);

/**
 * Load an image from raw bytes with optional scaling
 */
uint32_t neomacs_display_load_image_data_scaled(struct NeomacsDisplay *handle,
                                                const uint8_t *data,
                                                uintptr_t len,
                                                int maxWidth,
                                                int maxHeight);

/**
 * Load an image from raw ARGB32 pixel data
 */
uint32_t neomacs_display_load_image_argb32(struct NeomacsDisplay *handle,
                                           const uint8_t *data,
                                           int width,
                                           int height,
                                           int stride);

/**
 * Load an image from raw RGB24 pixel data
 */
uint32_t neomacs_display_load_image_rgb24(struct NeomacsDisplay *handle,
                                          const uint8_t *data,
                                          int width,
                                          int height,
                                          int stride);

/**
 * Load an image from a file path (async - returns ID immediately)
 */
uint32_t neomacs_display_load_image_file(struct NeomacsDisplay *handle, const char *path);

/**
 * Load an image from a file path with scaling (async)
 */
uint32_t neomacs_display_load_image_file_scaled(struct NeomacsDisplay *handle,
                                                const char *path,
                                                int maxWidth,
                                                int maxHeight);

/**
 * Load an image directly as texture (same as load_image_file)
 */
uint32_t neomacs_display_load_image_file_direct(struct NeomacsDisplay *handle, const char *path);

/**
 * Load an image directly as texture with scaling
 */
uint32_t neomacs_display_load_image_file_direct_scaled(struct NeomacsDisplay *handle,
                                                       const char *path,
                                                       int maxWidth,
                                                       int maxHeight);

/**
 * Get image dimensions (works for pending and loaded images)
 */
int neomacs_display_get_image_size(struct NeomacsDisplay *handle,
                                   uint32_t imageId,
                                   int *width,
                                   int *height);

/**
 * Query image file dimensions without loading (fast - reads header only)
 */
int neomacs_display_query_image_file_size(struct NeomacsDisplay *handle,
                                          const char *path,
                                          int *width,
                                          int *height);

/**
 * Free an image from cache
 */
int neomacs_display_free_image(struct NeomacsDisplay *handle, uint32_t imageId);

/**
 * Set a floating video at a specific screen position
 */
void neomacs_display_set_floating_video(struct NeomacsDisplay *handle,
                                        uint32_t videoId,
                                        int x,
                                        int y,
                                        int width,
                                        int height);

/**
 * Remove a floating video
 */
void neomacs_display_clear_floating_video(struct NeomacsDisplay *handle, uint32_t videoId);

/**
 * Set a floating image at a specific screen position
 */
void neomacs_display_set_floating_image(struct NeomacsDisplay *handle,
                                        uint32_t imageId,
                                        int x,
                                        int y,
                                        int width,
                                        int height);

/**
 * Remove a floating image
 */
void neomacs_display_clear_floating_image(struct NeomacsDisplay *handle, uint32_t imageId);

/**
 * Clear a rectangular area of the display
 */
void neomacs_display_clear_area(struct NeomacsDisplay *handle, int x, int y, int width, int height);

/**
 * Clear only media glyphs (Image, Video, WebKit) in a rectangular area.
 * Called at the start of update_window_begin to clear stale media glyphs
 * before Emacs sends new positions.
 */
void neomacs_display_clear_media_in_area(struct NeomacsDisplay *handle,
                                         int x,
                                         int y,
                                         int width,
                                         int height);

/**
 * Clear all glyphs - used when frame layout changes
 */
void neomacs_display_clear_all_glyphs(struct NeomacsDisplay *handle);

/**
 * Clear all cursors
 */
void neomacs_display_clear_all_cursors(struct NeomacsDisplay *handle);

/**
 * Clear all borders (window dividers)
 */
void neomacs_display_clear_all_borders(struct NeomacsDisplay *handle);

/**
 * End frame and render
 * Returns 0 on success, 1 if layout changed, -1 on error
 */
int neomacs_display_end_frame(struct NeomacsDisplay *handle);

/**
 * Render the scene to an external Cairo context (stub)
 */
int neomacs_display_render_to_cairo(struct NeomacsDisplay *handle, void *cairoContext);

/**
 * Initialize the renderer with a Pango context (stub)
 */
void neomacs_display_init_pango(struct NeomacsDisplay *handle, void *pangoContext);

/**
 * Enable or disable GSK rendering (stub)
 */
void neomacs_display_set_gsk_enabled(struct NeomacsDisplay *handle, int enabled);

/**
 * Start smooth scroll animation
 */
void neomacs_display_smooth_scroll(struct NeomacsDisplay *handle,
                                   int windowId,
                                   float fromOffset,
                                   float toOffset);

/**
 * Reset cursor blink (call when cursor moves)
 */
void neomacs_display_reset_cursor_blink(struct NeomacsDisplay *handle);

/**
 * Set mouse pointer cursor shape.
 * Types: 0=hidden, 1=default/arrow, 2=text/ibeam, 3=hand/pointer,
 *        4=crosshair, 5=h-resize, 6=v-resize, 7=hourglass,
 *        8=nwse-resize, 9=nesw-resize, 10=nesw-resize, 11=nwse-resize
 */
void neomacs_display_set_mouse_cursor(struct NeomacsDisplay *handle, int cursorType);

/**
 * Warp (move) the mouse pointer to the given pixel position.
 */
void neomacs_display_warp_mouse(struct NeomacsDisplay *handle, int x, int y);

/**
 * Show a popup menu at position (x, y) with the given items.
 * The render thread will display the menu and send a MenuSelection event.
 */
void neomacs_display_show_popup_menu(struct NeomacsDisplay *handle,
                                     int x,
                                     int y,
                                     const struct CPopupMenuItem *items,
                                     int itemCount,
                                     const char *title,
                                     uint32_t fgColor,
                                     uint32_t bgColor);

/**
 * Hide the active popup menu.
 */
void neomacs_display_hide_popup_menu(struct NeomacsDisplay *handle);

/**
 * Show a tooltip at the given position with specified colors.
 */
void neomacs_display_show_tooltip(struct NeomacsDisplay *handle,
                                  float x,
                                  float y,
                                  const char *text,
                                  float fgR,
                                  float fgG,
                                  float fgB,
                                  float bgR,
                                  float bgG,
                                  float bgB);

/**
 * Hide the active tooltip.
 */
void neomacs_display_hide_tooltip(struct NeomacsDisplay *handle);

/**
 * Trigger visual bell flash effect.
 */
void neomacs_display_visual_bell(struct NeomacsDisplay *handle);

/**
 * Request window attention (urgency hint / taskbar flash).
 * If urgent is non-zero, uses Critical attention type; otherwise Informational.
 */
void neomacs_display_request_attention(struct NeomacsDisplay *handle, int urgent);

/**
 * Enable or disable scroll indicators and focus ring.
 * enabled: non-zero = on, zero = off.
 */
void neomacs_display_set_scroll_indicators(struct NeomacsDisplay *handle, int enabled);

/**
 * Set the custom title bar height (0 = hidden)
 */
void neomacs_display_set_titlebar_height(struct NeomacsDisplay *handle, int height);

/**
 * Toggle FPS counter overlay
 */
void neomacs_display_set_show_fps(struct NeomacsDisplay *handle, int enabled);

/**
 * Set window corner radius for borderless mode (0 = square corners)
 */
void neomacs_display_set_corner_radius(struct NeomacsDisplay *handle, int radius);

/**
 * Set extra line spacing and letter spacing (in pixels)
 */
void neomacs_display_set_extra_spacing(struct NeomacsDisplay *handle,
                                       int lineSpacing,
                                       int letterSpacing);

/**
 * Set background gradient (top and bottom colors, sRGB 0-255)
 */
void neomacs_display_set_background_gradient(struct NeomacsDisplay *handle,
                                             int enabled,
                                             int topR,
                                             int topG,
                                             int topB,
                                             int bottomR,
                                             int bottomG,
                                             int bottomB);

/**
 * Configure scroll bar appearance
 */
void neomacs_display_set_scroll_bar_config(struct NeomacsDisplay *handle,
                                           int width,
                                           int thumbRadius,
                                           int trackOpacity,
                                           int hoverBrightness);

/**
 * Configure indent guide rendering
 */
void neomacs_display_set_indent_guides(struct NeomacsDisplay *handle,
                                       int enabled,
                                       int r,
                                       int g,
                                       int b,
                                       int opacity);

/**
 * Configure rainbow indent guide colors (up to 6 cycling colors by depth)
 * Each color is passed as R,G,B (0-255) with opacity (0-100).
 * num_colors specifies how many color slots are used (max 6).
 */
void neomacs_display_set_indent_guide_rainbow(struct NeomacsDisplay *handle,
                                              int enabled,
                                              int numColors,
                                              int r1,
                                              int g1,
                                              int b1,
                                              int o1,
                                              int r2,
                                              int g2,
                                              int b2,
                                              int o2,
                                              int r3,
                                              int g3,
                                              int b3,
                                              int o3,
                                              int r4,
                                              int g4,
                                              int b4,
                                              int o4,
                                              int r5,
                                              int g5,
                                              int b5,
                                              int o5,
                                              int r6,
                                              int g6,
                                              int b6,
                                              int o6);

/**
 * Configure current line highlight rendering
 */
void neomacs_display_set_line_highlight(struct NeomacsDisplay *handle,
                                        int enabled,
                                        int r,
                                        int g,
                                        int b,
                                        int opacity);

/**
 * Configure visible whitespace rendering
 */
void neomacs_display_set_show_whitespace(struct NeomacsDisplay *handle,
                                         int enabled,
                                         int r,
                                         int g,
                                         int b,
                                         int opacity);

/**
 * Configure inactive window dimming (threaded mode)
 */
void neomacs_display_set_inactive_dim(struct NeomacsDisplay *handle, int enabled, int opacity);

/**
 * Configure cursor glow effect (threaded mode)
 */
void neomacs_display_set_cursor_glow(struct NeomacsDisplay *handle,
                                     int enabled,
                                     int r,
                                     int g,
                                     int b,
                                     int radius,
                                     int opacity);

/**
 * Configure cursor pulse animation (sinusoidal glow modulation)
 */
void neomacs_display_set_cursor_pulse(struct NeomacsDisplay *handle,
                                      int enabled,
                                      int speed,
                                      int minOpacity);

/**
 * Configure focus mode (dim outside current paragraph)
 */
void neomacs_display_set_focus_mode(struct NeomacsDisplay *handle, int enabled, int opacity);

/**
 * Configure minimap (code overview column)
 */
void neomacs_display_set_minimap(struct NeomacsDisplay *handle, int enabled, int width);

/**
 * Configure typing ripple effect
 */
void neomacs_display_set_typing_ripple(struct NeomacsDisplay *handle,
                                       int enabled,
                                       int maxRadius,
                                       int durationMs);

/**
 * Configure search highlight pulse
 */
void neomacs_display_set_search_pulse(struct NeomacsDisplay *handle, int enabled, int faceId);

/**
 * Configure zen mode (centered distraction-free)
 */
void neomacs_display_set_zen_mode(struct NeomacsDisplay *handle,
                                  int enabled,
                                  int contentWidthPct,
                                  int marginOpacity);

/**
 * Configure background pattern
 */
void neomacs_display_set_background_pattern(struct NeomacsDisplay *handle,
                                            int style,
                                            int spacing,
                                            int r,
                                            int g,
                                            int b,
                                            int opacity);

/**
 * Configure cursor color cycling (rainbow hue rotation)
 */
void neomacs_display_set_cursor_color_cycle(struct NeomacsDisplay *handle,
                                            int enabled,
                                            int speed,
                                            int saturation,
                                            int lightness);

/**
 * Configure header/mode-line shadow depth effect
 */
void neomacs_display_set_header_shadow(struct NeomacsDisplay *handle,
                                       int enabled,
                                       int intensity,
                                       int size);

/**
 * Configure line insertion/deletion animation
 */
void neomacs_display_set_line_animation(struct NeomacsDisplay *handle, int enabled, int durationMs);

/**
 * Configure vignette effect (edge darkening)
 */
void neomacs_display_set_vignette(struct NeomacsDisplay *handle,
                                  int enabled,
                                  int intensity,
                                  int radius);

/**
 * Configure inactive window color tint
 */
void neomacs_display_set_inactive_tint(struct NeomacsDisplay *handle,
                                       int enabled,
                                       int r,
                                       int g,
                                       int b,
                                       int opacity);

/**
 * Configure scroll progress indicator bar
 */
void neomacs_display_set_scroll_progress(struct NeomacsDisplay *handle,
                                         int enabled,
                                         int height,
                                         int r,
                                         int g,
                                         int b,
                                         int opacity);

/**
 * Configure active window border glow
 */
void neomacs_display_set_window_glow(struct NeomacsDisplay *handle,
                                     int enabled,
                                     int r,
                                     int g,
                                     int b,
                                     int radius,
                                     int intensity);

/**
 * Configure breadcrumb/path bar overlay
 */
void neomacs_display_set_breadcrumb(struct NeomacsDisplay *handle, int enabled, int opacity);

/**
 * Configure smooth border color transition on focus
 */
void neomacs_display_set_border_transition(struct NeomacsDisplay *handle,
                                           int enabled,
                                           int r,
                                           int g,
                                           int b,
                                           int durationMs);

/**
 * Configure buffer-local accent color strip
 */
void neomacs_display_set_accent_strip(struct NeomacsDisplay *handle, int enabled, int width);

/**
 * Configure frosted glass effect on mode-lines
 */
void neomacs_display_set_frosted_glass(struct NeomacsDisplay *handle,
                                       int enabled,
                                       int opacity,
                                       int blur);

/**
 * Configure typing speed indicator overlay
 */
void neomacs_display_set_typing_speed(struct NeomacsDisplay *handle, int enabled);

/**
 * Configure breadcrumb title fade animation
 */
void neomacs_display_set_title_fade(struct NeomacsDisplay *handle, int enabled, int durationMs);

/**
 * Configure selection region glow highlight
 */
void neomacs_display_set_region_glow(struct NeomacsDisplay *handle,
                                     int enabled,
                                     int faceId,
                                     int radius,
                                     int opacity);

/**
 * Configure cursor drop shadow
 */
void neomacs_display_set_cursor_shadow(struct NeomacsDisplay *handle,
                                       int enabled,
                                       int offsetX,
                                       int offsetY,
                                       int opacity);

/**
 * Configure animated focus ring around selected window
 */
void neomacs_display_set_focus_ring(struct NeomacsDisplay *handle,
                                    int enabled,
                                    int r,
                                    int g,
                                    int b,
                                    int opacity,
                                    int dashLength,
                                    int speed);

/**
 * Configure window background tint based on file type
 */
void neomacs_display_set_window_mode_tint(struct NeomacsDisplay *handle, int enabled, int opacity);

/**
 * Configure window watermark for empty/small buffers
 */
void neomacs_display_set_window_watermark(struct NeomacsDisplay *handle,
                                          int enabled,
                                          int opacity,
                                          int threshold);

/**
 * Configure cursor trail fade effect
 */
void neomacs_display_set_cursor_trail_fade(struct NeomacsDisplay *handle,
                                           int enabled,
                                           int length,
                                           int fadeMs);

/**
 * Configure idle screen dimming after inactivity
 */
void neomacs_display_set_idle_dim(struct NeomacsDisplay *handle,
                                  int enabled,
                                  int delaySecs,
                                  int opacity,
                                  int fadeMs);

/**
 * Configure noise/film grain texture overlay
 */
void neomacs_display_set_noise_grain(struct NeomacsDisplay *handle,
                                     int enabled,
                                     int intensity,
                                     int size);

/**
 * Configure smooth mode-line content transition
 */
void neomacs_display_set_mode_line_transition(struct NeomacsDisplay *handle,
                                              int enabled,
                                              int durationMs);

/**
 * Configure cursor wake animation (pop/scale effect on blink-on)
 */
void neomacs_display_set_cursor_wake(struct NeomacsDisplay *handle,
                                     int enabled,
                                     int durationMs,
                                     int scalePct);

/**
 * Configure window content shadow/depth between split panes
 */
void neomacs_display_set_window_content_shadow(struct NeomacsDisplay *handle,
                                               int enabled,
                                               int size,
                                               int opacity);

/**
 * Configure window edge snap indicator
 */
void neomacs_display_set_edge_snap(struct NeomacsDisplay *handle,
                                   int enabled,
                                   int r,
                                   int g,
                                   int b,
                                   int durationMs);

/**
 * Configure cursor crosshair guide lines
 */
void neomacs_display_set_cursor_crosshair(struct NeomacsDisplay *handle,
                                          int enabled,
                                          int r,
                                          int g,
                                          int b,
                                          int opacity);

/**
 * Configure buffer modified border indicator
 */
void neomacs_display_set_modified_indicator(struct NeomacsDisplay *handle,
                                            int enabled,
                                            int r,
                                            int g,
                                            int b,
                                            int width,
                                            int opacity);

/**
 * Configure inactive window stained glass effect
 */
void neomacs_display_set_stained_glass(struct NeomacsDisplay *handle,
                                       int enabled,
                                       int opacity,
                                       int saturation);

/**
 * Configure focused window gradient border
 */
void neomacs_display_set_focus_gradient_border(struct NeomacsDisplay *handle,
                                               int enabled,
                                               int topR,
                                               int topG,
                                               int topB,
                                               int botR,
                                               int botG,
                                               int botB,
                                               int width,
                                               int opacity);

/**
 * Configure cursor magnetism effect
 */
void neomacs_display_set_cursor_magnetism(struct NeomacsDisplay *handle,
                                          int enabled,
                                          int r,
                                          int g,
                                          int b,
                                          int ringCount,
                                          int durationMs,
                                          int opacity);

/**
 * Configure window depth shadow layers
 */
void neomacs_display_set_depth_shadow(struct NeomacsDisplay *handle,
                                      int enabled,
                                      int layers,
                                      int offset,
                                      int r,
                                      int g,
                                      int b,
                                      int opacity);

/**
 * Configure mode-line gradient background
 */
void neomacs_display_set_mode_line_gradient(struct NeomacsDisplay *handle,
                                            int enabled,
                                            int leftR,
                                            int leftG,
                                            int leftB,
                                            int rightR,
                                            int rightG,
                                            int rightB,
                                            int opacity);

/**
 * Configure window corner fold effect
 */
void neomacs_display_set_corner_fold(struct NeomacsDisplay *handle,
                                     int enabled,
                                     int size,
                                     int r,
                                     int g,
                                     int b,
                                     int opacity);

/**
 * Configure frosted window border effect
 */
void neomacs_display_set_frosted_border(struct NeomacsDisplay *handle,
                                        int enabled,
                                        int width,
                                        int opacity,
                                        int r,
                                        int g,
                                        int b);

/**
 * Configure line number pulse on cursor line
 */
void neomacs_display_set_line_number_pulse(struct NeomacsDisplay *handle,
                                           int enabled,
                                           int r,
                                           int g,
                                           int b,
                                           int intensity,
                                           int cycleMs);

/**
 * Configure window breathing border animation
 */
void neomacs_display_set_breathing_border(struct NeomacsDisplay *handle,
                                          int enabled,
                                          int r,
                                          int g,
                                          int b,
                                          int minOpacity,
                                          int maxOpacity,
                                          int cycleMs);

/**
 * Configure window scanline (CRT) effect
 */
void neomacs_display_set_scanlines(struct NeomacsDisplay *handle,
                                   int enabled,
                                   int spacing,
                                   int opacity,
                                   int r,
                                   int g,
                                   int b);

/**
 * Configure cursor comet tail effect
 */
void neomacs_display_set_cursor_comet(struct NeomacsDisplay *handle,
                                      int enabled,
                                      int trailLength,
                                      int fadeMs,
                                      int r,
                                      int g,
                                      int b,
                                      int opacity);

/**
 * Configure cursor spotlight/radial gradient effect
 */
void neomacs_display_set_cursor_spotlight(struct NeomacsDisplay *handle,
                                          int enabled,
                                          int radius,
                                          int intensity,
                                          int r,
                                          int g,
                                          int b);

/**
 * Configure cursor particle trail effect
 */
void neomacs_display_set_cursor_particles(struct NeomacsDisplay *handle,
                                          int enabled,
                                          int r,
                                          int g,
                                          int b,
                                          int count,
                                          int lifetimeMs,
                                          int gravity);

/**
 * Configure per-window rounded border
 */
void neomacs_display_set_window_border_radius(struct NeomacsDisplay *handle,
                                              int enabled,
                                              int radius,
                                              int borderWidth,
                                              int r,
                                              int g,
                                              int b,
                                              int opacity);

/**
 * Configure typing heat map overlay
 */
void neomacs_display_set_typing_heatmap(struct NeomacsDisplay *handle,
                                        int enabled,
                                        int r,
                                        int g,
                                        int b,
                                        int fadeMs,
                                        int opacity);

/**
 * Configure smooth theme transition (crossfade on background color change)
 */
void neomacs_display_set_theme_transition(struct NeomacsDisplay *handle,
                                          int enabled,
                                          int durationMs);

/**
 * Configure cursor click halo effect
 */
void neomacs_display_set_click_halo(struct NeomacsDisplay *handle,
                                    int enabled,
                                    int r,
                                    int g,
                                    int b,
                                    int durationMs,
                                    int maxRadius);

/**
 * Configure scroll velocity fade overlay
 */
void neomacs_display_set_scroll_velocity_fade(struct NeomacsDisplay *handle,
                                              int enabled,
                                              int maxOpacity,
                                              int fadeMs);

/**
 * Configure mini-buffer completion highlight glow
 */
void neomacs_display_set_minibuffer_highlight(struct NeomacsDisplay *handle,
                                              int enabled,
                                              int r,
                                              int g,
                                              int b,
                                              int opacity);

/**
 * Configure smooth window padding transition on resize
 */
void neomacs_display_set_resize_padding(struct NeomacsDisplay *handle,
                                        int enabled,
                                        int durationMs,
                                        int maxPadding);

/**
 * Configure cursor error pulse (brief color flash on bell)
 */
void neomacs_display_set_cursor_error_pulse(struct NeomacsDisplay *handle,
                                            int enabled,
                                            int r,
                                            int g,
                                            int b,
                                            int durationMs);

/**
 * Configure line wrap indicator overlay
 */
void neomacs_display_set_wrap_indicator(struct NeomacsDisplay *handle,
                                        int enabled,
                                        int r,
                                        int g,
                                        int b,
                                        int opacity);

/**
 * Configure per-window scroll momentum indicator
 */
void neomacs_display_set_scroll_momentum(struct NeomacsDisplay *handle,
                                         int enabled,
                                         int fadeMs,
                                         int width);

/**
 * Configure text fade-in animation for new content
 */
void neomacs_display_set_text_fade_in(struct NeomacsDisplay *handle, int enabled, int durationMs);

/**
 * Configure scroll line spacing animation (accordion effect on scroll)
 */
void neomacs_display_set_scroll_line_spacing(struct NeomacsDisplay *handle,
                                             int enabled,
                                             int maxSpacing,
                                             int durationMs);

/**
 * Configure window padding gradient (inner edge shading for depth)
 */
void neomacs_display_set_padding_gradient(struct NeomacsDisplay *handle,
                                          int enabled,
                                          int r,
                                          int g,
                                          int b,
                                          int opacity,
                                          int width);

/**
 * Configure smooth cursor size transition on text-scale-adjust
 */
void neomacs_display_set_cursor_size_transition(struct NeomacsDisplay *handle,
                                                int enabled,
                                                int durationMs);

/**
 * Configure window switch highlight fade
 */
void neomacs_display_set_window_switch_fade(struct NeomacsDisplay *handle,
                                            int enabled,
                                            int durationMs,
                                            int intensity);

/**
 * Configure mode-line separator style (threaded mode)
 */
void neomacs_display_set_mode_line_separator(struct NeomacsDisplay *handle,
                                             int style,
                                             int r,
                                             int g,
                                             int b,
                                             int height);

/**
 * Set the window title (threaded mode)
 */
void neomacs_display_set_title(struct NeomacsDisplay *handle, const char *title);

/**
 * Set fullscreen mode (threaded mode)
 * mode: 0=none, 1=width, 2=height, 3=both, 4=maximized
 */
void neomacs_display_set_fullscreen(struct NeomacsDisplay *handle, int mode);

/**
 * Minimize/iconify the window (threaded mode)
 */
void neomacs_display_set_minimized(struct NeomacsDisplay *handle, int minimized);

/**
 * Set window position (threaded mode)
 */
void neomacs_display_set_position(struct NeomacsDisplay *handle, int x, int y);

/**
 * Request window inner size change (threaded mode)
 */
void neomacs_display_request_size(struct NeomacsDisplay *handle, int width, int height);

/**
 * Set window decorations (threaded mode)
 */
void neomacs_display_set_decorated(struct NeomacsDisplay *handle, int decorated);

/**
 * Configure cursor blinking (enable/disable and interval)
 */
void neomacs_display_set_cursor_blink(struct NeomacsDisplay *handle, int enabled, int intervalMs);

/**
 * Configure cursor animation (smooth motion)
 */
void neomacs_display_set_cursor_animation(struct NeomacsDisplay *handle, int enabled, float speed);

/**
 * Configure all animation settings
 */
void neomacs_display_set_animation_config(struct NeomacsDisplay *handle,
                                          int cursorEnabled,
                                          float cursorSpeed,
                                          uint8_t cursorStyle,
                                          uint32_t cursorDurationMs,
                                          int crossfadeEnabled,
                                          uint32_t crossfadeDurationMs,
                                          int scrollEnabled,
                                          uint32_t scrollDurationMs,
                                          uint32_t scrollEffect,
                                          uint32_t scrollEasing,
                                          float trailSize,
                                          uint32_t crossfadeEffect,
                                          uint32_t crossfadeEasing);

/**
 * Check if animations are active
 */
int neomacs_display_has_animations(struct NeomacsDisplay *handle);

/**
 * Get backend name
 */
const char *neomacs_display_backend_name(struct NeomacsDisplay *handle);

/**
 * Check if backend is initialized
 */
int neomacs_display_is_initialized(struct NeomacsDisplay *handle);

/**
 * Create a GPU-accelerated NeomacsWidget (stub)
 */
void *neomacs_display_create_widget(void);

/**
 * Set the scene on a NeomacsWidget (stub)
 */
int neomacs_display_widget_set_scene(struct NeomacsDisplay *handle, void *widget);

/**
 * Initialize the GSK renderer's Pango context from a NeomacsWidget (stub)
 */
void neomacs_display_widget_init_pango(struct NeomacsDisplay *handle, void *widget);

/**
 * Render scene to a NeomacsWidget (stub)
 */
int neomacs_display_render_to_widget(struct NeomacsDisplay *handle, void *widget);

/**
 * Set the resize callback for winit windows.
 *
 * The callback will be invoked when the window is resized.
 */
void neomacs_display_set_resize_callback(ResizeCallbackFn callback, void *userData);

/**
 * Set the mouse button callback (stub)
 */
void neomacs_display_set_mouse_button_callback(MouseButtonCallbackFn callback, void *userData);

/**
 * Set the mouse motion callback (stub)
 */
void neomacs_display_set_mouse_motion_callback(MouseMotionCallbackFn callback, void *userData);

/**
 * Set the mouse scroll callback (stub)
 */
void neomacs_display_set_mouse_scroll_callback(MouseScrollCallbackFn callback, void *userData);

/**
 * Create a new terminal.
 *
 * Returns terminal ID (>0 on success, 0 on failure).
 * `mode`: 0=Window, 1=Inline, 2=Floating
 * `shell`: optional shell path (NULL for default)
 */
uint32_t neomacs_display_terminal_create(uint16_t cols,
                                         uint16_t rows,
                                         uint8_t mode,
                                         const char *shell);

/**
 * Write input data to a terminal (keyboard input from user).
 */
void neomacs_display_terminal_write(uint32_t terminalId, const uint8_t *data, uintptr_t len);

/**
 * Resize a terminal.
 */
void neomacs_display_terminal_resize(uint32_t terminalId, uint16_t cols, uint16_t rows);

/**
 * Destroy a terminal.
 */
void neomacs_display_terminal_destroy(uint32_t terminalId);

/**
 * Set floating terminal position and opacity.
 */
void neomacs_display_terminal_set_float(uint32_t terminalId, float x, float y, float opacity);

/**
 * Get visible text from a terminal.
 *
 * Returns a malloc'd C string (caller must free with `free()`).
 * Returns NULL on failure.
 */
char *neomacs_display_terminal_get_text(uint32_t terminalId);

/**
 * Set callback for WebKit new window/tab requests
 */
void neomacs_display_webkit_set_new_window_callback(bool (*callback)(uint32_t,
                                                                     const char*,
                                                                     const char*));

/**
 * Set callback for WebKit page load events
 */
void neomacs_display_webkit_set_load_callback(void (*callback)(uint32_t, int, const char*));

/**
 * Initialize WebKit subsystem with EGL display
 */
int neomacs_display_webkit_init(struct NeomacsDisplay *handle, void *eglDisplay);

/**
 * Create a new WebKit view (threaded mode only)
 */
uint32_t neomacs_display_webkit_create(struct NeomacsDisplay *handle, int width, int height);

/**
 * Destroy a WebKit view (threaded mode only)
 */
int neomacs_display_webkit_destroy(struct NeomacsDisplay *handle, uint32_t viewId);

/**
 * Load a URI in a WebKit view (threaded mode only)
 */
int neomacs_display_webkit_load_uri(struct NeomacsDisplay *handle,
                                    uint32_t viewId,
                                    const char *uri);

/**
 * Go back in a WebKit view (threaded mode only)
 */
int neomacs_display_webkit_go_back(struct NeomacsDisplay *handle, uint32_t viewId);

/**
 * Go forward in a WebKit view (threaded mode only)
 */
int neomacs_display_webkit_go_forward(struct NeomacsDisplay *handle, uint32_t viewId);

/**
 * Reload a WebKit view (threaded mode only)
 */
int neomacs_display_webkit_reload(struct NeomacsDisplay *handle, uint32_t viewId);

/**
 * Resize a WebKit view (threaded mode only)
 */
int neomacs_display_webkit_resize(struct NeomacsDisplay *handle,
                                  uint32_t viewId,
                                  int width,
                                  int height);

/**
 * Execute JavaScript in a WebKit view (threaded mode only)
 */
int neomacs_display_webkit_execute_js(struct NeomacsDisplay *handle,
                                      uint32_t viewId,
                                      const char *script);

/**
 * Set a floating WebKit view position and size
 */
void neomacs_display_set_floating_webkit(struct NeomacsDisplay *handle,
                                         uint32_t webkitId,
                                         int x,
                                         int y,
                                         int width,
                                         int height);

/**
 * Hide a floating WebKit view
 */
void neomacs_display_hide_floating_webkit(struct NeomacsDisplay *handle, uint32_t webkitId);

/**
 * Find which webkit view (floating or inline) is at the given coordinates
 */
int neomacs_display_webkit_at_position(struct NeomacsDisplay *handle,
                                       int x,
                                       int y,
                                       uint32_t *outWebkitId,
                                       int *outRelX,
                                       int *outRelY);

/**
 * Send keyboard event to WebKit view (threaded mode only)
 */
void neomacs_display_webkit_send_key(struct NeomacsDisplay *handle,
                                     uint32_t webkitId,
                                     uint32_t keyCode,
                                     uint32_t hardwareKeyCode,
                                     int pressed,
                                     uint32_t modifiers);

/**
 * Send pointer/mouse event to WebKit view (threaded mode only)
 */
void neomacs_display_webkit_send_pointer(struct NeomacsDisplay *handle,
                                         uint32_t webkitId,
                                         uint32_t eventType,
                                         int x,
                                         int y,
                                         uint32_t button,
                                         uint32_t state,
                                         uint32_t modifiers);

/**
 * Send scroll event to WebKit view (threaded mode only)
 */
void neomacs_display_webkit_send_scroll(struct NeomacsDisplay *handle,
                                        uint32_t webkitId,
                                        int x,
                                        int y,
                                        int deltaX,
                                        int deltaY);

/**
 * Click in WebKit view (threaded mode only)
 */
void neomacs_display_webkit_click(struct NeomacsDisplay *handle,
                                  uint32_t webkitId,
                                  int x,
                                  int y,
                                  uint32_t button);

/**
 * Scroll blit pixels in the pixel buffer (threaded mode only)
 *
 * This performs a GPU blit operation within the pixel buffer, copying pixels
 * from one vertical position to another. Used to implement Emacs's scroll_run_hook.
 *
 * Parameters:
 * - x, y: top-left corner of the region to scroll
 * - width, height: size of the region
 * - from_y, to_y: source and destination Y positions for the scroll
 * - bg_r, bg_g, bg_b: background color (0.0-1.0) to fill exposed region
 */
void neomacs_display_scroll_blit(struct NeomacsDisplay *handle,
                                 int x,
                                 int y,
                                 int width,
                                 int height,
                                 int fromY,
                                 int toY,
                                 float bgR,
                                 float bgG,
                                 float bgB);

/**
 * Get WebKit view title
 * NOTE: In threaded mode, title changes are delivered via InputEvent::WebKitTitleChanged.
 * This function returns null - use the callback-based API instead.
 */
char *neomacs_display_webkit_get_title(struct NeomacsDisplay *handle, uint32_t webkitId);

/**
 * Get WebKit view URL
 * NOTE: In threaded mode, URL changes are delivered via InputEvent::WebKitUrlChanged.
 * This function returns null - use the callback-based API instead.
 */
char *neomacs_display_webkit_get_url(struct NeomacsDisplay *handle, uint32_t webkitId);

/**
 * Get WebKit view loading progress
 * NOTE: In threaded mode, progress changes are delivered via InputEvent::WebKitProgressChanged.
 * This function returns -1.0 - use the callback-based API instead.
 */
double neomacs_display_webkit_get_progress(struct NeomacsDisplay *handle, uint32_t webkitId);

/**
 * Check if WebKit view is loading
 * NOTE: In threaded mode, loading state is inferred from progress events.
 * This function returns -1 (unknown) - use progress callbacks instead.
 */
int neomacs_display_webkit_is_loading(struct NeomacsDisplay *handle, uint32_t webkitId);

/**
 * Free a string returned by webkit_get_title or webkit_get_url
 */
void neomacs_display_webkit_free_string(char *s);

/**
 * Update WebKit view - no-op in threaded mode
 * In threaded mode, GLib main context is pumped automatically on the render thread.
 */
int neomacs_display_webkit_update(struct NeomacsDisplay *handle, uint32_t webkitId);

/**
 * Update all WebKit views - no-op in threaded mode
 * In threaded mode, GLib main context is pumped automatically on the render thread.
 */
int neomacs_display_webkit_update_all(struct NeomacsDisplay *handle);

/**
 * Add a WPE glyph to the current row
 */
void neomacs_display_add_wpe_glyph(struct NeomacsDisplay *handle,
                                   uint32_t viewId,
                                   int pixelWidth,
                                   int pixelHeight);

/**
 * Create a new window with the specified dimensions and title.
 *
 * Returns the window ID. The window will be created during the next poll_events call.
 * Returns 0 if the backend is not available.
 */
uint32_t neomacs_display_create_window(struct NeomacsDisplay *handle,
                                       int32_t width,
                                       int32_t height,
                                       const char *title);

/**
 * Destroy a window by its ID.
 */
void neomacs_display_destroy_window(struct NeomacsDisplay *handle, uint32_t windowId);

/**
 * Show or hide a window.
 */
void neomacs_display_show_window(struct NeomacsDisplay *handle, uint32_t windowId, bool visible);

/**
 * Set the title of a window.
 */
void neomacs_display_set_window_title(struct NeomacsDisplay *handle,
                                      uint32_t windowId,
                                      const char *title);

/**
 * Set the size of a window.
 */
void neomacs_display_set_window_size(struct NeomacsDisplay *handle,
                                     uint32_t windowId,
                                     int32_t width,
                                     int32_t height);

/**
 * Begin a frame for a specific window.
 *
 * Clears the window's scene to prepare for new content.
 */
void neomacs_display_begin_frame_window(struct NeomacsDisplay *handle,
                                        uint32_t windowId,
                                        float charWidth,
                                        float charHeight,
                                        float fontPixelSize);

/**
 * End a frame for a specific window and present it.
 *
 * Renders the window's scene to its surface and presents it.
 */
void neomacs_display_end_frame_window(struct NeomacsDisplay *handle, uint32_t windowId);

/**
 * Called from C when `neomacs-use-rust-display` is enabled.
 * The Rust layout engine reads buffer data via FFI helpers and produces
 * a FrameGlyphBuffer, bypassing the C matrix extraction.
 *
 * # Safety
 * Must be called on the Emacs thread. All pointers must be valid.
 */
void neomacs_rust_layout_frame(struct NeomacsDisplay *handle,
                               void *framePtr,
                               float width,
                               float height,
                               float charWidth,
                               float charHeight,
                               float fontPixelSize,
                               uint32_t background,
                               uint32_t verticalBorderFg,
                               int32_t rightDividerWidth,
                               int32_t bottomDividerWidth,
                               uint32_t dividerFg,
                               uint32_t dividerFirstFg,
                               uint32_t dividerLastFg);

/**
 * Set an animation configuration option (stub)
 */
int neomacs_display_set_animation_option(struct NeomacsDisplay *handle,
                                         const char *key,
                                         const char *value);

/**
 * Get an animation configuration option (stub)
 */
char *neomacs_display_get_animation_option(struct NeomacsDisplay *handle, const char *key);

/**
 * Free a string returned by neomacs_display_get_animation_option
 */
void neomacs_display_free_string(char *s);

/**
 * Update cursor animation state (stub)
 */
int neomacs_display_update_animation(struct NeomacsDisplay *handle, double dt);

/**
 * Check if animation needs continuous redraw (stub)
 */
int neomacs_display_animation_active(struct NeomacsDisplay *handle);

/**
 * Trigger a buffer transition animation (stub)
 */
int neomacs_display_start_buffer_transition(struct NeomacsDisplay *handle,
                                            const char *effect,
                                            int durationMs);

/**
 * Prepare for buffer transition (stub)
 */
int neomacs_display_prepare_buffer_transition(struct NeomacsDisplay *handle);

/**
 * Trigger buffer transition animation (stub)
 */
int neomacs_display_trigger_buffer_transition(struct NeomacsDisplay *handle);

/**
 * Check if buffer transition is ready (stub)
 */
int neomacs_display_has_transition_snapshot(struct NeomacsDisplay *handle);

/**
 * Initialize display in threaded mode
 *
 * Returns the wakeup pipe fd that Emacs should select() on,
 * or -1 on error.
 */
int neomacs_display_init_threaded(uint32_t width, uint32_t height, const char *title);

/**
 * Drain input events from render thread
 *
 * Returns number of events written to buffer.
 */
int neomacs_display_drain_input(struct NeomacsInputEvent *events, int maxEvents);

/**
 * Get the next batch of dropped file paths.
 * Returns the number of paths written.  Each path is a null-terminated
 * C string that must be freed with `neomacs_clipboard_free_text`.
 * Call repeatedly until it returns 0 to drain all pending drops.
 */
int neomacs_display_get_dropped_files(char **outPaths, int maxPaths);

/**
 * Free a string returned by `neomacs_display_get_dropped_files`.
 */
void neomacs_display_free_dropped_path(char *path);

/**
 * Get the terminal title from the most recent title change event.
 * Returns a C string that must be freed with
 * `neomacs_display_free_dropped_path` (same allocator), or NULL.
 */
char *neomacs_display_get_terminal_title(uint32_t terminalId);

/**
 * Send frame glyphs to render thread
 */
void neomacs_display_send_frame(struct NeomacsDisplay *handle);

/**
 * Send command to render thread
 */
void neomacs_display_send_command(int cmdType,
                                  uint32_t id,
                                  uint32_t param1,
                                  uint32_t param2,
                                  const char *strParam);

/**
 * Configure matrix/digital rain effect
 */
void neomacs_display_set_matrix_rain(struct NeomacsDisplay *handle,
                                     int enabled,
                                     int r,
                                     int g,
                                     int b,
                                     int columnCount,
                                     int speed,
                                     int opacity);

/**
 * Configure cursor elastic snap animation
 */
void neomacs_display_set_cursor_elastic_snap(struct NeomacsDisplay *handle,
                                             int enabled,
                                             int overshoot,
                                             int durationMs);

/**
 * Configure window frost/ice border effect
 */
void neomacs_display_set_frost_border_effect(struct NeomacsDisplay *handle,
                                             int enabled,
                                             int r,
                                             int g,
                                             int b,
                                             int width,
                                             int opacity);

/**
 * Configure cursor afterimage ghost effect
 */
void neomacs_display_set_cursor_ghost(struct NeomacsDisplay *handle,
                                      int enabled,
                                      int r,
                                      int g,
                                      int b,
                                      int count,
                                      int fadeMs,
                                      int drift,
                                      int opacity);

/**
 * Configure window edge glow on scroll boundaries
 */
void neomacs_display_set_edge_glow(struct NeomacsDisplay *handle,
                                   int enabled,
                                   int r,
                                   int g,
                                   int b,
                                   int height,
                                   int opacity,
                                   int fadeMs);

/**
 * Configure window rain/drip ambient effect
 */
void neomacs_display_set_rain_effect(struct NeomacsDisplay *handle,
                                     int enabled,
                                     int r,
                                     int g,
                                     int b,
                                     int dropCount,
                                     int speed,
                                     int opacity);

/**
 * Configure cursor ripple wave effect on keystroke
 */
void neomacs_display_set_cursor_ripple_wave(struct NeomacsDisplay *handle,
                                            int enabled,
                                            int r,
                                            int g,
                                            int b,
                                            int ringCount,
                                            int maxRadius,
                                            int durationMs,
                                            int opacity);

/**
 * Configure window aurora/northern lights effect
 */
void neomacs_display_set_aurora(struct NeomacsDisplay *handle,
                                int enabled,
                                int r1,
                                int g1,
                                int b1,
                                int r2,
                                int g2,
                                int b2,
                                int height,
                                int speed,
                                int opacity);

/**
 * Configure heat distortion effect
 */
void neomacs_display_set_heat_distortion(struct NeomacsDisplay *handle,
                                         int enabled,
                                         int intensity,
                                         int speed,
                                         int edgeWidth,
                                         int opacity);

/**
 * Configure cursor lighthouse beam effect
 */
void neomacs_display_set_cursor_lighthouse(struct NeomacsDisplay *handle,
                                           int enabled,
                                           int r,
                                           int g,
                                           int b,
                                           int beamWidth,
                                           int rotationSpeed,
                                           int beamLength,
                                           int opacity);

/**
 * Configure neon border effect
 */
void neomacs_display_set_neon_border(struct NeomacsDisplay *handle,
                                     int enabled,
                                     int r,
                                     int g,
                                     int b,
                                     int intensity,
                                     int flicker,
                                     int thickness,
                                     int opacity);

/**
 * Configure cursor sonar ping effect
 */
void neomacs_display_set_cursor_sonar_ping(struct NeomacsDisplay *handle,
                                           int enabled,
                                           int r,
                                           int g,
                                           int b,
                                           int ringCount,
                                           int maxRadius,
                                           int durationMs,
                                           int opacity);

/**
 * Configure lightning bolt effect
 */
void neomacs_display_set_lightning_bolt(struct NeomacsDisplay *handle,
                                        int enabled,
                                        int r,
                                        int g,
                                        int b,
                                        int frequency,
                                        int intensity,
                                        int opacity);

/**
 * Configure cursor orbit particles effect
 */
void neomacs_display_set_cursor_orbit_particles(struct NeomacsDisplay *handle,
                                                int enabled,
                                                int r,
                                                int g,
                                                int b,
                                                int particleCount,
                                                int orbitRadius,
                                                int speed,
                                                int opacity);

/**
 * Configure plasma border effect
 */
void neomacs_display_set_plasma_border(struct NeomacsDisplay *handle,
                                       int enabled,
                                       int r1,
                                       int g1,
                                       int b1,
                                       int r2,
                                       int g2,
                                       int b2,
                                       int width,
                                       int speed,
                                       int opacity);

/**
 * Configure cursor heartbeat pulse effect
 */
void neomacs_display_set_cursor_heartbeat(struct NeomacsDisplay *handle,
                                          int enabled,
                                          int r,
                                          int g,
                                          int b,
                                          int bpm,
                                          int maxRadius,
                                          int opacity);

/**
 * Configure topographic contour effect
 */
void neomacs_display_set_topo_contour(struct NeomacsDisplay *handle,
                                      int enabled,
                                      int r,
                                      int g,
                                      int b,
                                      int spacing,
                                      int speed,
                                      int opacity);

/**
 * Configure cursor metronome tick effect
 */
void neomacs_display_set_cursor_metronome(struct NeomacsDisplay *handle,
                                          int enabled,
                                          int r,
                                          int g,
                                          int b,
                                          int tickHeight,
                                          int fadeMs,
                                          int opacity);

/**
 * Configure constellation overlay effect
 */
void neomacs_display_set_constellation(struct NeomacsDisplay *handle,
                                       int enabled,
                                       int r,
                                       int g,
                                       int b,
                                       int starCount,
                                       int connectDist,
                                       int twinkleSpeed,
                                       int opacity);

/**
 * Configure cursor radar sweep effect
 */
void neomacs_display_set_cursor_radar(struct NeomacsDisplay *handle,
                                      int enabled,
                                      int r,
                                      int g,
                                      int b,
                                      int radius,
                                      int speed,
                                      int opacity);

/**
 * Configure hex grid overlay effect
 */
void neomacs_display_set_hex_grid(struct NeomacsDisplay *handle,
                                  int enabled,
                                  int r,
                                  int g,
                                  int b,
                                  int cellSize,
                                  int pulseSpeed,
                                  int opacity);

/**
 * Configure cursor sparkle burst effect
 */
void neomacs_display_set_cursor_sparkle_burst(struct NeomacsDisplay *handle,
                                              int enabled,
                                              int r,
                                              int g,
                                              int b,
                                              int particleCount,
                                              int burstRadius,
                                              int opacity);

/**
 * Configure circuit board trace effect
 */
void neomacs_display_set_circuit_trace(struct NeomacsDisplay *handle,
                                       int enabled,
                                       int r,
                                       int g,
                                       int b,
                                       int traceWidth,
                                       int speed,
                                       int opacity);

/**
 * Configure cursor compass rose effect
 */
void neomacs_display_set_cursor_compass(struct NeomacsDisplay *handle,
                                        int enabled,
                                        int r,
                                        int g,
                                        int b,
                                        int size,
                                        int speed,
                                        int opacity);

/**
 * Configure warp/distortion grid effect
 */
void neomacs_display_set_warp_grid(struct NeomacsDisplay *handle,
                                   int enabled,
                                   int r,
                                   int g,
                                   int b,
                                   int density,
                                   int amplitude,
                                   int speed,
                                   int opacity);

/**
 * Configure cursor DNA helix trail effect
 */
void neomacs_display_set_cursor_dna_helix(struct NeomacsDisplay *handle,
                                          int enabled,
                                          int r1,
                                          int g1,
                                          int b1,
                                          int r2,
                                          int g2,
                                          int b2,
                                          int radius,
                                          int speed,
                                          int opacity);

/**
 * Configure prism/rainbow edge effect
 */
void neomacs_display_set_prism_edge(struct NeomacsDisplay *handle,
                                    int enabled,
                                    int width,
                                    int speed,
                                    int saturation,
                                    int opacity);

/**
 * Configure cursor pendulum swing effect
 */
void neomacs_display_set_cursor_pendulum(struct NeomacsDisplay *handle,
                                         int enabled,
                                         int r,
                                         int g,
                                         int b,
                                         int arcLength,
                                         int damping,
                                         int opacity);

/**
 * Configure kaleidoscope overlay effect
 */
void neomacs_display_set_kaleidoscope(struct NeomacsDisplay *handle,
                                      int enabled,
                                      int r,
                                      int g,
                                      int b,
                                      int segments,
                                      int speed,
                                      int opacity);

/**
 * Configure cursor ripple ring effect
 */
void neomacs_display_set_cursor_ripple_ring(struct NeomacsDisplay *handle,
                                            int enabled,
                                            int r,
                                            int g,
                                            int b,
                                            int maxRadius,
                                            int ringCount,
                                            int speed,
                                            int opacity);

/**
 * Configure noise field overlay effect
 */
void neomacs_display_set_noise_field(struct NeomacsDisplay *handle,
                                     int enabled,
                                     int r,
                                     int g,
                                     int b,
                                     int scale,
                                     int speed,
                                     int opacity);

/**
 * Configure cursor scope effect
 */
void neomacs_display_set_cursor_scope(struct NeomacsDisplay *handle,
                                      int enabled,
                                      int r,
                                      int g,
                                      int b,
                                      int thickness,
                                      int gap,
                                      int opacity);

/**
 * Configure spiral vortex overlay effect
 */
void neomacs_display_set_spiral_vortex(struct NeomacsDisplay *handle,
                                       int enabled,
                                       int r,
                                       int g,
                                       int b,
                                       int arms,
                                       int speed,
                                       int opacity);

/**
 * Configure cursor shockwave effect
 */
void neomacs_display_set_cursor_shockwave(struct NeomacsDisplay *handle,
                                          int enabled,
                                          int r,
                                          int g,
                                          int b,
                                          int radius,
                                          int decay,
                                          int opacity);

/**
 * Configure diamond lattice overlay effect
 */
void neomacs_display_set_diamond_lattice(struct NeomacsDisplay *handle,
                                         int enabled,
                                         int r,
                                         int g,
                                         int b,
                                         int cellSize,
                                         int shimmerSpeed,
                                         int opacity);

/**
 * Configure cursor gravity well effect
 */
void neomacs_display_set_cursor_gravity_well(struct NeomacsDisplay *handle,
                                             int enabled,
                                             int r,
                                             int g,
                                             int b,
                                             int fieldRadius,
                                             int lineCount,
                                             int opacity);

/**
 * Configure rotating gear overlay effect
 */
void neomacs_display_set_rotating_gear(struct NeomacsDisplay *handle,
                                       int enabled,
                                       int r,
                                       int g,
                                       int b,
                                       int gearSize,
                                       int rotationSpeed,
                                       int opacity);

/**
 * Configure cursor prism effect
 */
void neomacs_display_set_cursor_prism(struct NeomacsDisplay *handle,
                                      int enabled,
                                      int r,
                                      int g,
                                      int b,
                                      int rayCount,
                                      int spread,
                                      int opacity);

/**
 * Configure crosshatch pattern overlay effect
 */
void neomacs_display_set_crosshatch_pattern(struct NeomacsDisplay *handle,
                                            int enabled,
                                            int r,
                                            int g,
                                            int b,
                                            int lineSpacing,
                                            int angle,
                                            int speed,
                                            int opacity);

/**
 * Configure cursor moth effect
 */
void neomacs_display_set_cursor_moth(struct NeomacsDisplay *handle,
                                     int enabled,
                                     int r,
                                     int g,
                                     int b,
                                     int mothCount,
                                     int wingSize,
                                     int opacity);

/**
 * Configure concentric rings overlay effect
 */
void neomacs_display_set_concentric_rings(struct NeomacsDisplay *handle,
                                          int enabled,
                                          int r,
                                          int g,
                                          int b,
                                          int ringSpacing,
                                          int expansionSpeed,
                                          int opacity);

/**
 * Configure cursor flame effect
 */
void neomacs_display_set_cursor_flame(struct NeomacsDisplay *handle,
                                      int enabled,
                                      int r,
                                      int g,
                                      int b,
                                      int particleCount,
                                      int height,
                                      int opacity);

/**
 * Configure zigzag pattern overlay effect
 */
void neomacs_display_set_zigzag_pattern(struct NeomacsDisplay *handle,
                                        int enabled,
                                        int r,
                                        int g,
                                        int b,
                                        int amplitude,
                                        int frequency,
                                        int speed,
                                        int opacity);

/**
 * Configure cursor crystal effect
 */
void neomacs_display_set_cursor_crystal(struct NeomacsDisplay *handle,
                                        int enabled,
                                        int r,
                                        int g,
                                        int b,
                                        int facetCount,
                                        int radius,
                                        int opacity);

/**
 * Configure moir pattern overlay effect
 */
void neomacs_display_set_moire_pattern(struct NeomacsDisplay *handle,
                                       int enabled,
                                       int r,
                                       int g,
                                       int b,
                                       int lineSpacing,
                                       int angleOffset,
                                       int speed,
                                       int opacity);

/**
 * Configure cursor lightning effect
 */
void neomacs_display_set_cursor_lightning(struct NeomacsDisplay *handle,
                                          int enabled,
                                          int r,
                                          int g,
                                          int b,
                                          int boltCount,
                                          int maxLength,
                                          int opacity);

/**
 * Configure dot matrix overlay effect
 */
void neomacs_display_set_dot_matrix(struct NeomacsDisplay *handle,
                                    int enabled,
                                    int r,
                                    int g,
                                    int b,
                                    int dotSpacing,
                                    int pulseSpeed,
                                    int opacity);

/**
 * Configure cursor snowflake effect
 */
void neomacs_display_set_cursor_snowflake(struct NeomacsDisplay *handle,
                                          int enabled,
                                          int r,
                                          int g,
                                          int b,
                                          int count,
                                          int fallSpeed,
                                          int opacity);

/**
 * Configure sunburst pattern overlay effect
 */
void neomacs_display_set_sunburst_pattern(struct NeomacsDisplay *handle,
                                          int enabled,
                                          int r,
                                          int g,
                                          int b,
                                          int rayCount,
                                          int speed,
                                          int opacity);

/**
 * Configure cursor firework effect
 */
void neomacs_display_set_cursor_firework(struct NeomacsDisplay *handle,
                                         int enabled,
                                         int r,
                                         int g,
                                         int b,
                                         int particleCount,
                                         int burstRadius,
                                         int opacity);

/**
 * Configure honeycomb dissolve overlay effect
 */
void neomacs_display_set_honeycomb_dissolve(struct NeomacsDisplay *handle,
                                            int enabled,
                                            int r,
                                            int g,
                                            int b,
                                            int cellSize,
                                            int dissolveSpeed,
                                            int opacity);

/**
 * Configure cursor tornado effect
 */
void neomacs_display_set_cursor_tornado(struct NeomacsDisplay *handle,
                                        int enabled,
                                        int r,
                                        int g,
                                        int b,
                                        int radius,
                                        int particleCount,
                                        int opacity);

/**
 * Configure wave interference overlay effect
 */
void neomacs_display_set_wave_interference(struct NeomacsDisplay *handle,
                                           int enabled,
                                           int r,
                                           int g,
                                           int b,
                                           int wavelength,
                                           int sourceCount,
                                           int speed,
                                           int opacity);

/**
 * Configure cursor portal effect
 */
void neomacs_display_set_cursor_portal(struct NeomacsDisplay *handle,
                                       int enabled,
                                       int r,
                                       int g,
                                       int b,
                                       int radius,
                                       int speed,
                                       int opacity);

/**
 * Configure chevron pattern overlay effect
 */
void neomacs_display_set_chevron_pattern(struct NeomacsDisplay *handle,
                                         int enabled,
                                         int r,
                                         int g,
                                         int b,
                                         int spacing,
                                         int speed,
                                         int opacity);

/**
 * Configure cursor bubble effect
 */
void neomacs_display_set_cursor_bubble(struct NeomacsDisplay *handle,
                                       int enabled,
                                       int r,
                                       int g,
                                       int b,
                                       int count,
                                       int riseSpeed,
                                       int opacity);

/**
 * Shutdown threaded display
 */
void neomacs_display_shutdown_threaded(void);

/**
 * Get wakeup fd for threaded mode (for Emacs to select() on)
 */
int neomacs_display_get_threaded_wakeup_fd(void);

/**
 * Get display handle for threaded mode
 *
 * Returns the NeomacsDisplay handle for use with frame operations.
 * Returns NULL if threaded mode is not initialized.
 */
struct NeomacsDisplay *neomacs_display_get_threaded_handle(void);

/**
 * Set clipboard text.  The text is a UTF-8 C string.
 * Returns 0 on success, -1 on failure.
 */
int neomacs_clipboard_set_text(const char *text);

/**
 * Get clipboard text.  Returns a newly allocated UTF-8 C string
 * that the caller must free with neomacs_clipboard_free_text(),
 * or NULL if the clipboard is empty or an error occurred.
 */
char *neomacs_clipboard_get_text(void);

/**
 * Free a string returned by neomacs_clipboard_get_text().
 */
void neomacs_clipboard_free_text(char *text);

/**
 * Set primary selection text.  The text is a UTF-8 C string.
 * Returns 0 on success, -1 on failure.
 */
int neomacs_primary_selection_set_text(const char *text);

/**
 * Get primary selection text.  Returns a newly allocated UTF-8 C string
 * that the caller must free with neomacs_clipboard_free_text(),
 * or NULL if the selection is empty or an error occurred.
 */
char *neomacs_primary_selection_get_text(void);

/**
 * Get a byte from buffer text at the given byte position.
 * Handles the gap buffer transparently.
 * Returns -1 if pos is out of range.
 */
extern int neomacs_layout_buffer_byte_at(EmacsBuffer buffer, int64_t bytePos);

/**
 * Copy buffer text (UTF-8) into the provided buffer.
 * Handles gap buffer and multibyte encoding.
 * Returns the number of bytes written, or -1 on error.
 * `from` and `to` are character positions (not byte positions).
 */
extern int64_t neomacs_layout_buffer_text(EmacsBuffer buffer,
                                          int64_t from,
                                          int64_t to,
                                          uint8_t *outBuf,
                                          int64_t outBufLen);

/**
 * Get the character at a character position.
 * Returns the Unicode codepoint, or -1 if out of range.
 */
extern int32_t neomacs_layout_char_at(EmacsBuffer buffer, int64_t charpos);

/**
 * Get buffer narrowing bounds: BEGV and ZV (character positions).
 */
extern void neomacs_layout_buffer_bounds(EmacsBuffer buffer, int64_t *begv, int64_t *zv);

/**
 * Get buffer point position (character position).
 */
extern int64_t neomacs_layout_buffer_point(EmacsBuffer buffer);

/**
 * Check if buffer uses multibyte encoding.
 */
extern int neomacs_layout_buffer_multibyte_p(EmacsBuffer buffer);

/**
 * Get buffer-local tab-width.
 */
extern int neomacs_layout_buffer_tab_width(EmacsBuffer buffer);

/**
 * Get buffer-local truncate-lines setting.
 */
extern int neomacs_layout_buffer_truncate_lines(EmacsBuffer buffer);

/**
 * Get the number of leaf windows in the frame.
 */
extern int neomacs_layout_frame_window_count(EmacsFrame frame);

/**
 * Get window parameters for the Nth leaf window.
 * Fills the WindowParamsFFI struct. Returns 0 on success, -1 on error.
 */
extern int neomacs_layout_get_window_params(EmacsFrame frame,
                                            int windowIndex,
                                            struct WindowParamsFFI *params);

/**
 * Get the resolved face at a buffer position for a given window.
 * Returns face data in the FaceDataFFI struct.
 * This calls face_at_buffer_position() internally.
 * If next_check_out is non-null, writes the position where the face may change.
 */
extern int neomacs_layout_face_at_pos(EmacsWindow window,
                                      int64_t charpos,
                                      struct FaceDataFFI *faceOut,
                                      int64_t *nextCheckOut);

/**
 * Get the default face for a frame.
 */
extern int neomacs_layout_default_face(EmacsFrame frame, struct FaceDataFFI *faceOut);

/**
 * Set window_end_pos on an Emacs window (for window-end Lisp function).
 */
extern void neomacs_layout_set_window_end(EmacsWindow window, int64_t endPos, int endVpos);

/**
 * Set cursor position on an Emacs window.
 */
extern void neomacs_layout_set_cursor(EmacsWindow window, int x, int y, int hpos, int vpos);

/**
 * Trigger fontification at a position (calls fontification-functions).
 * Returns 1 if fontification happened, 0 if text was already fontified.
 */
extern int neomacs_layout_ensure_fontified(EmacsBuffer buffer, int64_t from, int64_t to);

/**
 * Check if text at charpos is invisible.
 * Returns 0 = visible, 1 = invisible (hidden), 2 = invisible (ellipsis).
 * If invisible, *next_visible_out is set to the next visible position.
 */
extern int neomacs_layout_check_invisible(EmacsBuffer buffer,
                                          EmacsWindow window,
                                          int64_t charpos,
                                          int64_t *nextVisibleOut);

/**
 * Get mode-line text for a window as plain UTF-8.
 * Returns the number of bytes written, or -1 on error.
 * Also fills face_out with the mode-line face (active or inactive).
 */
extern int64_t neomacs_layout_mode_line_text(EmacsWindow window,
                                             EmacsFrame frame,
                                             uint8_t *outBuf,
                                             int64_t outBufLen,
                                             struct FaceDataFFI *faceOut);

/**
 * Get header-line text for a window as plain UTF-8.
 * Returns the number of bytes written, 0 if no header-line, or -1 on error.
 * Also fills face_out with the header-line face (active or inactive).
 */
extern int64_t neomacs_layout_header_line_text(EmacsWindow window,
                                               EmacsFrame frame,
                                               uint8_t *outBuf,
                                               int64_t outBufLen,
                                               struct FaceDataFFI *faceOut);

/**
 * Get tab-line text for a window as plain UTF-8.
 * Returns the number of bytes written, 0 if no tab-line, or -1 on error.
 * Also fills face_out with the tab-line face.
 */
extern int64_t neomacs_layout_tab_line_text(EmacsWindow window,
                                            EmacsFrame frame,
                                            uint8_t *outBuf,
                                            int64_t outBufLen,
                                            struct FaceDataFFI *faceOut);

/**
 * Get line number display configuration for a window.
 * Returns 0 on success, -1 on error.
 */
extern int neomacs_layout_line_number_config(EmacsWindow window,
                                             EmacsBuffer buffer,
                                             int64_t bufferZv,
                                             int maxRows,
                                             struct LineNumberConfigFFI *configOut);

/**
 * Count the line number at a character position.
 * Returns the 1-based line number.
 */
extern int64_t neomacs_layout_count_line_number(EmacsBuffer buffer, int64_t charpos, int widen);

/**
 * Resolve the face for a line number and fill FaceDataFFI.
 */
extern int neomacs_layout_line_number_face(EmacsWindow window,
                                           int isCurrent,
                                           int64_t lnum,
                                           int majorTick,
                                           int minorTick,
                                           struct FaceDataFFI *faceOut);

/**
 * Check for a 'display text property at charpos.
 * Handles string replacement and space specs.
 * Writes replacement string into str_buf (type=1).
 * Fills DisplayPropFFI with type, length, and region end.
 * Returns 0 on success, -1 on error.
 */
extern int neomacs_layout_check_display_prop(EmacsBuffer buffer,
                                             EmacsWindow window,
                                             int64_t charpos,
                                             uint8_t *strBuf,
                                             int strBufLen,
                                             struct DisplayPropFFI *out);

/**
 * Collect overlay before-string and after-string at a position.
 * Before-strings come from overlays starting at charpos.
 * After-strings come from overlays ending at charpos.
 * Returns 0 on success, -1 on error.
 */
extern int neomacs_layout_overlay_strings_at(EmacsBuffer buffer,
                                             EmacsWindow window,
                                             int64_t charpos,
                                             uint8_t *beforeBuf,
                                             int beforeBufLen,
                                             int *beforeLenOut,
                                             uint8_t *afterBuf,
                                             int afterBufLen,
                                             int *afterLenOut,
                                             struct FaceDataFFI *beforeFaceOut,
                                             struct FaceDataFFI *afterFaceOut);

/**
 * Check if a character should display as a glyphless glyph.
 * Looks up Vglyphless_char_display char-table.
 * method_out: 0=normal, 1=thin_space, 2=empty_box, 3=hex_code,
 *             4=acronym, 5=zero_width.
 * For method=4 (acronym), writes the string into str_buf.
 */
extern int neomacs_layout_check_glyphless(EmacsFrame frame,
                                          int codepoint,
                                          int *methodOut,
                                          uint8_t *strBuf,
                                          int strBufLen,
                                          int *strLenOut);

/**
 * Collect margin overlay strings at a buffer position.
 * Checks overlay before/after-strings for (margin left-margin) and
 * (margin right-margin) display properties.
 */
extern int neomacs_layout_margin_strings_at(EmacsBuffer buffer,
                                            EmacsWindow window,
                                            int64_t charpos,
                                            uint8_t *leftBuf,
                                            int leftBufLen,
                                            int *leftLenOut,
                                            uint8_t *rightBuf,
                                            int rightBufLen,
                                            int *rightLenOut);

/**
 * Check line-height and line-spacing text properties at a position.
 * Returns extra height (pixels) beyond base_height for the row.
 */
extern int neomacs_layout_check_line_spacing(EmacsBuffer buffer,
                                             EmacsWindow window,
                                             int64_t charpos,
                                             float baseHeight,
                                             float *extraHeightOut);

/**
 * Check line-prefix or wrap-prefix text property at a position.
 * prefix_type: 0=line-prefix, 1=wrap-prefix
 * Returns prefix width in columns via width_out.
 * width_out = -1.0 means no override (use window default).
 */
extern int neomacs_layout_check_line_prefix(EmacsBuffer buffer,
                                            EmacsWindow window,
                                            int64_t charpos,
                                            int prefixType,
                                            float *widthOut);

#endif  /* NEOMACS_DISPLAY_H */
