; call-process and call-process-region baseline behavior.
(call-process "true")
(let ((code (call-process "false"))) (/= code 0))
(with-temp-buffer
  (insert "abc")
  (call-process-region (point-min) (point-max) "true"))
(with-temp-buffer
  (list (call-process "echo" nil 2 nil "hello")
        (buffer-string)))
(with-temp-buffer
  (insert "abc")
  (list (call-process-region (point-min) (point-max) "cat" nil 3 nil)
        (buffer-string)))
(progn
  (get-buffer-create "cp-src")
  (get-buffer-create "cp-dst")
  (with-current-buffer "cp-src" (erase-buffer))
  (with-current-buffer "cp-dst" (erase-buffer))
  (with-current-buffer "cp-src"
    (list (call-process "echo" nil "cp-dst" nil "hello")
          (buffer-string)
          (with-current-buffer "cp-dst"
            (string-prefix-p "hello" (buffer-string))))))
(progn
  (get-buffer-create "cpr-src")
  (get-buffer-create "cpr-dst")
  (with-current-buffer "cpr-src" (erase-buffer) (insert "abc"))
  (with-current-buffer "cpr-dst" (erase-buffer))
  (with-current-buffer "cpr-src"
    (list (call-process-region (point-min) (point-max) "cat" nil "cpr-dst" nil)
          (buffer-string)
          (with-current-buffer "cpr-dst" (buffer-string)))))
(let ((out "/tmp/neovm-vm-compat-process-out.txt"))
  (condition-case nil (delete-file out) (error nil))
  (call-process "sh" nil (list :file out) nil "-c" "echo out; echo err >&2")
  (with-temp-buffer
    (insert-file-contents out)
    (and (string-match-p "out" (buffer-string))
         (string-match-p "err" (buffer-string))
         t)))
(let ((out "/tmp/neovm-vm-compat-process-out-split.txt")
      (err "/tmp/neovm-vm-compat-process-err-split.txt"))
  (condition-case nil (delete-file out) (error nil))
  (condition-case nil (delete-file err) (error nil))
  (call-process "sh" nil (list (list :file out) err) nil "-c" "echo out; echo err >&2")
  (list
   (with-temp-buffer
     (insert-file-contents out)
     (string-prefix-p "out" (buffer-string)))
   (with-temp-buffer
     (insert-file-contents err)
     (string-prefix-p "err" (buffer-string)))))
(condition-case err
    (call-process "echo" nil 'foo nil "x")
  (error (car err)))
(condition-case err
    (call-process "echo" nil '(t 99) nil "x")
  (error (car err)))
(with-temp-buffer
  (list
   (call-process "cat" "/etc/passwd" t nil)
   (> (length (buffer-string)) 0)))
(with-temp-buffer
  (insert "abc")
  (list (call-process-region nil nil "cat" nil t nil)
        (buffer-string)))
(with-temp-buffer
  (insert "abcdef")
  (goto-char 3)
  (let ((m (copy-marker (point))))
    (list (call-process-region m (point-max) "cat" nil t nil)
          (buffer-string))))
(with-temp-buffer
  (insert "abc")
  (list (call-process-region "xyz" nil "cat" nil t nil)
        (buffer-string)))
(condition-case err
    (call-process-region "xyz" nil "cat" t t nil)
  (error (car err)))
(with-temp-buffer
  (insert "abc")
  (list (call-process-region (point-max) (point-min) "cat" nil t nil)
        (buffer-string)))
(with-temp-buffer
  (insert "abc")
  (list (call-process-region (point-max) (point-min) "cat" t t nil)
        (buffer-string)))
(with-temp-buffer
  (insert "abc")
  (condition-case err
      (call-process-region 1 nil "cat" nil t nil)
    (error (car err))))
(with-temp-buffer
  (insert "abc")
  (condition-case err
      (call-process-region nil 1 "cat" nil t nil)
    (error (car err))))
(with-temp-buffer
  (insert "abc")
  (condition-case err
      (call-process-region "xyz" nil "cat" nil nil nil)
    (error (car err))))
(with-temp-buffer
  (insert "abc")
  (list (call-process-region (point-min) (point-max) "cat" t nil nil)
        (buffer-string)))
(with-temp-buffer
  (insert "abc")
  (condition-case err
      (call-process-region (make-marker) (point-max) "cat" nil t nil)
    (error (car err))))
(with-temp-buffer
  (insert "abc")
  (condition-case err
      (call-process-region (point-min) (make-marker) "cat" nil t nil)
    (error (car err))))
(with-temp-buffer
  (insert "abc")
  (condition-case err
      (call-process-region -1 2 "cat" nil t nil)
    (error (car err))))
(with-temp-buffer
  (insert "abc")
  (condition-case err
      (call-process-region 1 999999 "cat" nil t nil)
    (error (car err))))
(condition-case err
    (call-process "cat" "/nonexistent/neovm-vm-compat-process-infile")
  (error (car err)))
(condition-case err
    (call-process "/nonexistent/neovm-vm-compat-missing-prog")
  (error (car err)))
(with-temp-buffer
  (insert "x")
  (condition-case err
      (call-process-region (point-min) (point-max) "/nonexistent/neovm-vm-compat-missing-prog")
    (error (car err))))
