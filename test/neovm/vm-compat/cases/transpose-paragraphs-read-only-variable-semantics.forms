; transpose-paragraphs should honor dynamic/local/global `buffer-read-only`.
(with-temp-buffer
  (insert (concat "A" (make-string 1 10) (make-string 1 10) "B"))
  (goto-char 1)
  (setq buffer-read-only t)
  (condition-case err (transpose-paragraphs 1) (error (car err))))

(with-temp-buffer
  (insert (concat "A" (make-string 1 10) (make-string 1 10) "B"))
  (goto-char 1)
  (let ((buffer-read-only t))
    (condition-case err (transpose-paragraphs 1) (error (car err)))))

(let ((orig (default-value 'buffer-read-only)))
  (unwind-protect
      (progn
        (setq-default buffer-read-only t)
        (with-temp-buffer
          (insert (concat "A" (make-string 1 10) (make-string 1 10) "B"))
          (goto-char 1)
          (condition-case err
              (progn
                (transpose-paragraphs 1)
                (subst-char-in-string 10 ?| (buffer-string) t))
            (error (car err)))))
    (setq-default buffer-read-only orig)))

; boundary errors should still win when no transpose is possible.
(with-temp-buffer
  (insert (concat "A" (make-string 1 10) (make-string 1 10)))
  (goto-char 1)
  (setq buffer-read-only t)
  (condition-case err (transpose-paragraphs 1) (error (car err))))

(with-temp-buffer
  (insert (concat "A" (make-string 1 10) (make-string 1 10) "B"))
  (goto-char 1)
  (transpose-paragraphs 1)
  (subst-char-in-string 10 ?| (buffer-string) t))
