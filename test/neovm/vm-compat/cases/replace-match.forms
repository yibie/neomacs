(with-temp-buffer (insert "foo bar") (goto-char (point-min)) (re-search-forward "\\(foo\\)") (replace-match "baz") (buffer-string))
(with-temp-buffer (insert "foo bar") (goto-char (point-min)) (re-search-forward "\\(foo\\)") (replace-match "\\1Z" nil nil) (buffer-string))
(with-temp-buffer (insert "foo bar") (goto-char (point-min)) (re-search-forward "\\(foo\\)") (replace-match "\\1Z" nil t) (buffer-string))
(with-temp-buffer (insert "FOO bar") (goto-char (point-min)) (re-search-forward "FOO") (replace-match "baz" nil nil) (buffer-string))
(with-temp-buffer (insert "Foo bar") (goto-char (point-min)) (re-search-forward "Foo") (replace-match "baz" nil nil) (buffer-string))
(with-temp-buffer (insert "Foo bar") (goto-char (point-min)) (re-search-forward "Foo") (replace-match "baz" t nil) (buffer-string))
(with-temp-buffer (insert "abc123") (goto-char (point-min)) (re-search-forward "\\([a-z]+\\)\\([0-9]+\\)") (replace-match "X" nil nil nil 2) (buffer-string))
(with-temp-buffer (insert "abc123") (goto-char (point-min)) (re-search-forward "\\([a-z]+\\)\\([0-9]+\\)") (replace-match "X" nil nil nil 0) (buffer-string))
(with-temp-buffer (insert "123") (goto-char (point-min)) (re-search-forward "\\([a-z]+\\)?\\([0-9]+\\)") (condition-case err (replace-match "X" nil nil nil 1) (error (list (car err) (car (cdr err))))))
(with-temp-buffer (insert "123") (goto-char (point-min)) (re-search-forward "\\([a-z]+\\)?\\([0-9]+\\)") (condition-case err (replace-match "X" nil nil nil 9) (error (list (car err) (car (cdr err))))))
(let ((s "abc123")) (string-match "\\([a-z]+\\)\\([0-9]+\\)" s) (replace-match "X" nil nil s 2))
(let ((s "abc123")) (string-match "\\([a-z]+\\)\\([0-9]+\\)" s) (replace-match "\\1X" nil nil s 2))
(let ((s "abc123")) (string-match "\\([a-z]+\\)\\([0-9]+\\)" s) (replace-match "\\1X" nil t s 2))
(let ((s "abc123")) (string-match "\\([a-z]+\\)\\([0-9]+\\)" s) (replace-match "Z" nil nil s 0))
(let ((s "abc123")) (string-match "\\([a-z]+\\)\\([0-9]+\\)" s) (replace-match "Z" nil nil s 1))
(let ((s "abc123")) (string-match "\\([a-z]+\\)\\([0-9]+\\)" s) (replace-match "Z" nil nil s 2))
(let ((s "abc123")) (string-match "\\([a-z]+\\)\\([0-9]+\\)" s) (condition-case err (replace-match "Z" nil nil s 3) (error (list (car err) (car (cdr err))))))
(let ((s "abc123")) (string-match "\\([a-z]+\\)\\([0-9]+\\)" s) (condition-case err (replace-match "Z" nil nil s -1) (error (list (car err) (cdr err)))))
(let ((s "abc")) (condition-case err (replace-match "Z" nil nil s 0) (error (list (car err) (car (cdr err))))))
(with-temp-buffer (insert "abc") (goto-char (point-min)) (condition-case err (replace-match "Z") (error (list (car err) (car (cdr err))))))
(with-temp-buffer (insert "abc") (goto-char (point-min)) (condition-case err (replace-match "Z" nil nil "abc") (error (list (car err) (car (cdr err))))))
(with-temp-buffer (insert "abc") (goto-char (point-min)) (condition-case err (replace-match 123) (error (list (car err) (car (cdr err))))))
(with-temp-buffer (insert "abc") (goto-char (point-min)) (condition-case err (replace-match "Z" nil nil 5) (error (list (car err) (car (cdr err))))))
(with-temp-buffer (insert "abc") (goto-char (point-min)) (condition-case err (replace-match "Z" nil nil nil "x") (error (list (car err) (car (cdr err))))))
(with-temp-buffer (insert "abc") (goto-char (point-min)) (condition-case err (replace-match "Z" nil nil nil -1) (error (list (car err) (car (cdr err))))))
(with-temp-buffer (insert "abc") (goto-char (point-min)) (condition-case err (replace-match "Z" nil nil nil 0 1 2) (error (list (car err) (car (cdr err))))))
(let ((s "x")) (string-match "x" s) (replace-match "é" nil nil s))
(let ((s "x")) (string-match "x" s) (replace-match "éz" nil nil s))
(let ((s "x")) (string-match "x" s) (replace-match "\\&é" nil nil s))
(let ((s "x")) (string-match "\\(x\\)" s) (replace-match "\\1é" nil nil s))
(let ((s "abc123")) (string-match "\\([a-z]+\\)\\([0-9]+\\)" s) (condition-case err (replace-match "Z" nil nil s 9) (error err)))
(with-temp-buffer (insert "abc123") (goto-char (point-min)) (re-search-forward "\\([a-z]+\\)\\([0-9]+\\)") (condition-case err (replace-match "Z" nil nil nil 9) (error err)))
