; Lock in undo return/error payload semantics.
(with-temp-buffer
  (buffer-enable-undo)
  (insert "x")
  (list (condition-case err (undo 1) (error err))
        (buffer-string)))

(with-temp-buffer
  (buffer-enable-undo)
  (insert "abc")
  (undo-boundary)
  (list (condition-case err (undo 1) (error err))
        (buffer-string)))

(with-temp-buffer
  (buffer-enable-undo)
  (insert "a")
  (undo-boundary)
  (insert "b")
  (list (condition-case err (undo 1) (error err))
        (buffer-string)))

(condition-case err (undo 1) (error err))

(with-temp-buffer
  (buffer-enable-undo)
  (insert "x")
  (undo-boundary)
  (list (condition-case err (undo 0) (error err))
        (buffer-string)))

(with-temp-buffer
  (buffer-enable-undo)
  (insert "x")
  (list (condition-case err (undo 0) (error err))
        (buffer-string)))
