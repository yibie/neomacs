; set-file-modes argument validation and mode mutation semantics.

(condition-case err
    (set-file-modes 1 #o600)
  (error err))

(condition-case err
    (set-file-modes "/tmp/neovm-set-file-modes-missing" nil)
  (error err))

(condition-case err
    (set-file-modes "/tmp/neovm-set-file-modes-missing" #o600 nil nil)
  (error err))

(condition-case err
    (set-file-modes "/tmp/neovm-set-file-modes-missing" #o600)
  (error (car err)))

(let ((f (make-temp-file "neovm-set-file-modes-core-")))
  (prog1
      (list (set-file-modes f #o600)
            (file-modes f))
    (delete-file f)))

(let ((f (make-temp-file "neovm-set-file-modes-flag-")))
  (prog1
      (list (set-file-modes f #o640 t)
            (file-modes f))
    (delete-file f)))

(let* ((base (make-temp-file "neovm-set-file-modes-eval-" t))
       (f (expand-file-name "alpha.txt" base)))
  (with-temp-buffer
    (insert "x")
    (write-region nil nil f))
  (prog1
      (let ((default-directory (file-name-as-directory base)))
        (list (set-file-modes "alpha.txt" #o600)
              (file-modes "alpha.txt")))
    (delete-file f)
    (delete-directory base)))
