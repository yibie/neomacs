; Relative file mutators should honor eval-time default-directory.
(setq vm-fo-base
      (let* ((forms-file (getenv "NEOVM_FORMS_FILE"))
             (base (if forms-file (file-name-directory forms-file) default-directory)))
        (expand-file-name "directory-files-fixtures" base)))
(condition-case err
    (let* ((default-directory vm-fo-base)
           (a "vm-fileops-a.tmp")
           (b "vm-fileops-b.tmp")
           (c "vm-fileops-c.tmp"))
      (condition-case _ (delete-file a) (error nil))
      (condition-case _ (delete-file b) (error nil))
      (condition-case _ (delete-file c) (error nil))
      (copy-file "alpha.txt" a)
      (rename-file a b)
      (copy-file b c)
      (delete-file b)
      (list (file-exists-p a) (file-exists-p b) (file-exists-p c)))
  (list 'error (car err) (nth 1 err)))
(let ((default-directory vm-fo-base))
  (condition-case _ (delete-file "vm-fileops-c.tmp") (error nil))
  (file-exists-p "vm-fileops-c.tmp"))
