(setq bookmark-default-file "/tmp/neovm-bookmark-default-state")
(ignore-errors (delete-file bookmark-default-file))

(defun bm-save-shape (v)
  (if (and (listp v) (= (length v) 5))
      (list 'list5 (stringp (nth 0 v)) (integerp (nth 1 v)) (integerp (nth 2 v)) (integerp (nth 3 v)) (integerp (nth 4 v)))
    v))

(condition-case err (bm-save-shape (bookmark-save nil)) (error err))
(condition-case err (bm-save-shape (bookmark-save nil)) (error err))

(setq bookmark-default-file "/tmp/neovm-bookmark-default-state-2")
(ignore-errors (delete-file bookmark-default-file))
(ignore-errors (delete-file "/tmp/neovm-bookmark-explicit-state"))
(condition-case err (bm-save-shape (bookmark-save nil "/tmp/neovm-bookmark-explicit-state" t)) (error err))
(condition-case err
    (let ((r (bookmark-save nil nil nil)))
      (if (and (listp r) (= (length r) 5))
          (equal (car r) "/tmp/neovm-bookmark-explicit-state")
        r))
  (error err))
