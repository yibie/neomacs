# NeoVM / Neomacs Plan

Last updated: 2026-02-15

## Done

- Added display/terminal stub compatibility slice:
  - exposed and wired display-side builtins: `redraw-frame`, `redraw-display`, `open-termscript`, `ding`, `send-string-to-terminal`, `internal-show-cursor`, `internal-show-cursor-p`
  - exposed `last-nonminibuffer-frame` and locked current batch behavior to oracle
  - added oracle corpus:
    - `test/neovm/vm-compat/cases/display-stub-semantics.forms`
    - `test/neovm/vm-compat/cases/display-stub-semantics.expected.tsv`
    - enabled in `test/neovm/vm-compat/cases/default.list`
  - verified:
    - `make -C test/neovm/vm-compat record FORMS=cases/display-stub-semantics.forms EXPECTED=cases/display-stub-semantics.expected.tsv` (pass)
    - `make -C test/neovm/vm-compat check-neovm FORMS=cases/display-stub-semantics.forms EXPECTED=cases/display-stub-semantics.expected.tsv` (pass)
    - `make -C test/neovm/vm-compat validate-case-lists` (pass)
    - `make -C test/neovm/vm-compat check-all-neovm` (pass)
- Expanded display/terminal stub semantics to match more oracle behavior:
  - `redraw-frame` now enforces frame designator type checks (`frame-live-p` predicate payload)
  - `open-termscript` now signals the batch tty error payload used by GNU Emacs
  - `send-string-to-terminal` now validates optional terminal designators (`terminal-live-p` predicate payload)
  - `internal-show-cursor` / `internal-show-cursor-p` now enforce window designator shape and maintain shared visibility state
  - expanded oracle corpus (`cases/display-stub-semantics`) with error payload and designator checks
  - verified:
    - `cargo test display::tests -- --nocapture` (pass)
    - `make -C test/neovm/vm-compat check-neovm FORMS=cases/display-stub-semantics.forms EXPECTED=cases/display-stub-semantics.expected.tsv` (pass)
    - `make -C test/neovm/vm-compat validate-case-lists` (pass)
    - `make -C test/neovm/vm-compat check-all-neovm` (pass)
- Added TTY batch semantics compatibility slice:
  - `tty-type`, `tty-top-frame`, `controlling-tty-p` now reject invalid terminal designators with `wrong-type-argument` (`terminal-live-p` payload)
  - `suspend-tty` and `resume-tty` now signal GNU-compatible non-text terminal `error` payloads in batch mode while preserving type checks on invalid designators
  - added oracle corpus:
    - `test/neovm/vm-compat/cases/tty-batch-semantics.forms`
    - `test/neovm/vm-compat/cases/tty-batch-semantics.expected.tsv`
    - enabled in `test/neovm/vm-compat/cases/default.list`
  - verified:
    - `cargo test display::tests -- --nocapture` (pass)
    - `make -C test/neovm/vm-compat check-neovm FORMS=cases/tty-batch-semantics.forms EXPECTED=cases/tty-batch-semantics.expected.tsv` (pass)
    - `make -C test/neovm/vm-compat validate-case-lists` (pass)
    - `make -C test/neovm/vm-compat check-all-neovm` (pass)
- Added X display batch semantics compatibility slice:
  - `x-open-connection` now enforces string display argument typing and returns display-open errors in batch context
  - `x-close-connection` now dispatches batch-compatible error classes for nil/string/non-frame designators
  - `x-display-pixel-width` / `x-display-pixel-height` now signal batch/X-not-available errors and frame-designator type errors
  - `x-display-color-p` now returns `nil` for batch current display and reports argument-shape errors for invalid designators
  - added oracle corpus:
    - `test/neovm/vm-compat/cases/x-display-batch-semantics.forms`
    - `test/neovm/vm-compat/cases/x-display-batch-semantics.expected.tsv`
    - enabled in `test/neovm/vm-compat/cases/default.list`
  - verified:
    - `cargo test display::tests -- --nocapture` (pass)
    - `make -C test/neovm/vm-compat check-neovm FORMS=cases/x-display-batch-semantics.forms EXPECTED=cases/x-display-batch-semantics.expected.tsv` (pass)
    - `make -C test/neovm/vm-compat validate-case-lists` (pass)
    - `make -C test/neovm/vm-compat check-all-neovm` (pass)
- Added font batch semantics compatibility slice:
  - `list-fonts` and `find-font` now enforce `font-spec` argument typing and preserve batch-mode nil results for valid specs
  - `font-family-list` now matches batch defaults (`nil`) and rejects non-nil frame designators with `frame-live-p` type predicate payload
  - added oracle corpus:
    - `test/neovm/vm-compat/cases/font-batch-semantics.forms`
    - `test/neovm/vm-compat/cases/font-batch-semantics.expected.tsv`
    - enabled in `test/neovm/vm-compat/cases/default.list`
  - verified:
    - `cargo test font::tests -- --nocapture` (pass)
    - `make -C test/neovm/vm-compat check-neovm FORMS=cases/font-batch-semantics.forms EXPECTED=cases/font-batch-semantics.expected.tsv` (pass)
    - `make -C test/neovm/vm-compat validate-case-lists` (pass)
    - `make -C test/neovm/vm-compat check-all-neovm` (pass)
- Added face batch semantics compatibility slice:
  - `face-id` now signals GNU-compatible invalid-face errors for non-face designators while preserving `default` face baseline id behavior
  - `face-font` now signals GNU-compatible invalid-face errors for non-face designators and keeps batch `nil` default-face behavior
  - added oracle corpus:
    - `test/neovm/vm-compat/cases/face-batch-semantics.forms`
    - `test/neovm/vm-compat/cases/face-batch-semantics.expected.tsv`
    - enabled in `test/neovm/vm-compat/cases/default.list`
  - verified:
    - `cargo test font::tests -- --nocapture` (pass)
    - `make -C test/neovm/vm-compat check-neovm FORMS=cases/face-batch-semantics.forms EXPECTED=cases/face-batch-semantics.expected.tsv` (pass)
    - `make -C test/neovm/vm-compat validate-case-lists` (pass)
    - `make -C test/neovm/vm-compat check-all-neovm` (pass)
- Added timer compatibility slice (`run-at-time` / `run-with-idle-timer` / `timer-activate`):
  - `run-at-time` now accepts GNU-compatible immediate specs for `nil` and numeric-prefixed strings like `"0 sec"` (while invalid specs signal `error`)
  - `run-with-timer` compatibility is now lock-in covered for numeric, `nil`, and `"0 sec"` immediate forms
  - `run-with-idle-timer` now accepts `nil` delay and keeps non-numeric delay specs as `error`
  - `timer-activate` now matches error-class behavior on invalid/active timer activation paths
  - `sleep-for` is now exposed in builtin registry/dispatch and matches core GNU argument/error semantics in batch mode
  - `sit-for` now enforces GNU-compatible arity bounds (1..=2 args; extra args signal `wrong-number-of-arguments`)
  - timer corpus now locks additional timer arity/error paths (`timerp`, `cancel-timer`, `timer-activate`) under `condition-case`
  - added oracle corpus:
    - `test/neovm/vm-compat/cases/timer-semantics.forms`
    - `test/neovm/vm-compat/cases/timer-semantics.expected.tsv`
    - enabled in `test/neovm/vm-compat/cases/default.list`
  - verified:
    - `cargo test test_eval_run_at_time -- --nocapture` (pass)
    - `cargo test test_eval_run_with_idle_timer_nil_ok_string_error -- --nocapture` (pass)
    - `cargo test test_eval_timer_activate -- --nocapture` (pass)
    - `make -C test/neovm/vm-compat validate-case-lists` (pass)
    - `make -C test/neovm/vm-compat check-neovm FORMS=cases/timer-semantics.forms EXPECTED=cases/timer-semantics.expected.tsv` (pass)
    - `make -C test/neovm/vm-compat check-all-neovm` (pass)
- Added `minibuffer-contents-no-properties` builtin compatibility slice:
  - implemented evaluator-aware builtin in `neovm-core` with batch behavior matching `minibuffer-contents`
  - wired builtin dispatch and registry exposure (`fboundp`/dispatch parity)
  - added oracle corpus:
    - `test/neovm/vm-compat/cases/minibuffer-contents-no-properties-semantics.forms`
    - `test/neovm/vm-compat/cases/minibuffer-contents-no-properties-semantics.expected.tsv`
    - enabled in `test/neovm/vm-compat/cases/default.list`
  - verified:
    - `cargo test minibuffer_contents_no_properties -- --nocapture` (pass)
    - `make -C test/neovm/vm-compat validate-case-lists` (pass)
    - `make -C test/neovm/vm-compat check-neovm FORMS=cases/minibuffer-contents-no-properties-semantics.forms EXPECTED=cases/minibuffer-contents-no-properties-semantics.expected.tsv` (pass)
    - `make -C test/neovm/vm-compat check-all-neovm` (pass)
- Fixed vm-compat raw-byte string rendering in worker execution path:
  - added byte-preserving evaluator-aware helpers in `neovm-core` (`print_value_bytes_with_eval`, `format_eval_result_bytes_with_eval`)
  - switched `neovm-core` compat runner output to buffered byte writes
  - switched `neovm-worker` elisp executor result rendering to `print_value_bytes_with_eval`
- Re-verified non-Unicode oracle slices and full suite:
  - `make -C test/neovm/vm-compat check-neovm FORMS=cases/make-string-raw-byte-semantics.forms EXPECTED=cases/make-string-raw-byte-semantics.expected.tsv` (pass)
  - `make -C test/neovm/vm-compat check-neovm FORMS=cases/make-string-nonunicode-semantics.forms EXPECTED=cases/make-string-nonunicode-semantics.expected.tsv` (pass)
  - `make -C test/neovm/vm-compat check-neovm FORMS=cases/string-nonunicode-char-semantics.forms EXPECTED=cases/string-nonunicode-char-semantics.expected.tsv` (pass)
  - `make -C test/neovm/vm-compat check-neovm FORMS=cases/string-nonunicode-indexing-semantics.forms EXPECTED=cases/string-nonunicode-indexing-semantics.expected.tsv` (pass)
  - `make -C test/neovm/vm-compat check-neovm FORMS=cases/string-nonunicode-concat-semantics.forms EXPECTED=cases/string-nonunicode-concat-semantics.expected.tsv` (pass)
  - `make -C test/neovm/vm-compat check-neovm FORMS=cases/string-nonunicode-sequence-semantics.forms EXPECTED=cases/string-nonunicode-sequence-semantics.expected.tsv` (pass)
  - `make -C test/neovm/vm-compat check-all-neovm` (pass)
- Aligned `documentation` builtin semantics with oracle behavior:
  - `function-documentation` property now takes precedence for symbol arguments
  - symbol lookup now distinguishes `void-function` and `invalid-function` paths
  - non-callable non-symbol function arguments now signal `invalid-function`
  - lambda/defmacro evaluation now captures docstring metadata in `LambdaData`
- Added and enabled new oracle corpus:
  - `test/neovm/vm-compat/cases/documentation-semantics.forms`
  - `test/neovm/vm-compat/cases/documentation-semantics.expected.tsv`
  - wired into `test/neovm/vm-compat/cases/default.list` and `test/neovm/vm-compat/cases/introspection.list`
- Verified the documentation slice end-to-end:
  - `cargo test documentation_ -- --nocapture` (pass)
  - `cargo test captures_docstring_metadata -- --nocapture` (pass)
  - `cd test/neovm/vm-compat && make check-neovm FORMS=cases/documentation-semantics.forms EXPECTED=cases/documentation-semantics.expected.tsv` (pass)
  - `cd test/neovm/vm-compat && make check-neovm FORMS=cases/documentation-property-semantics.forms EXPECTED=cases/documentation-property-semantics.expected.tsv` (pass)
  - `cd test/neovm/vm-compat && make validate-case-lists` (pass)
- Implemented evaluator-aware `documentation-property` semantics:
  - reads symbol plist entries through evaluator obarray state
  - returns string-valued properties, maps non-string property values to `nil`
  - preserves `wrong-type-argument` on non-symbol first arg and `nil` on non-symbol property key
- Added and enabled new oracle corpus:
  - `test/neovm/vm-compat/cases/documentation-property-semantics.forms`
  - `test/neovm/vm-compat/cases/documentation-property-semantics.expected.tsv`
  - wired into `test/neovm/vm-compat/cases/default.list` and `test/neovm/vm-compat/cases/introspection.list`
- Verified compatibility and list integrity for the slice:
  - `cd test/neovm/vm-compat && make check-neovm FORMS=cases/documentation-property-semantics.forms EXPECTED=cases/documentation-property-semantics.expected.tsv` (pass)
  - `cd test/neovm/vm-compat && make validate-case-lists` (pass)
- Aligned compat/worker result rendering with evaluator-aware opaque handle formatting:
  - added `format_eval_result_with_eval` and `print_value_with_eval` in `neovm-core`
  - switched vm-compat runner output to evaluator-aware formatting path
  - switched worker task result byte rendering to evaluator-aware handle printing
- Re-verified thread compatibility corpus after rendering path update:
  - `cd test/neovm/vm-compat && make check-thread-neovm` (pass)
- Full suite re-verified after JSON keyword-error and display batch-semantics slices:
  - `cd test/neovm/vm-compat && make check-all-neovm` (pass)
- Full suite re-verified after JSON buffer builtin routing + cl_lib JSON cleanup:
  - `cd test/neovm/vm-compat && make check-all-neovm` (pass)
- Full suite baseline verified after JSON compatibility slice:
  - `cd test/neovm/vm-compat && NEOVM_ORACLE_EMACS=/nix/store/hql3zwz5b4ywd2qwx8jssp4dyb7nx4cb-emacs-30.2/bin/emacs make check-all-neovm` (pass)
- Full suite baseline verified after `set-time-zone-rule` / `current-time-zone` slice:
  - `cd test/neovm/vm-compat && NEOVM_ORACLE_EMACS=/nix/store/hql3zwz5b4ywd2qwx8jssp4dyb7nx4cb-emacs-30.2/bin/emacs make check-all-neovm` (pass)
- Full suite baseline verified after `safe-date-to-time` slice:
  - `cd test/neovm/vm-compat && NEOVM_ORACLE_EMACS=/nix/store/hql3zwz5b4ywd2qwx8jssp4dyb7nx4cb-emacs-30.2/bin/emacs make check-all-neovm` (pass)
- Full suite baseline verified after latest cleanup:
  - `cd test/neovm/vm-compat && make check-all-neovm` (pass)
- Full suite re-verified after terminal parameter semantics slice:
  - `cd test/neovm/vm-compat && NEOVM_ORACLE_EMACS=/nix/store/hql3zwz5b4ywd2qwx8jssp4dyb7nx4cb-emacs-30.2/bin/emacs make check-all-neovm` (pass)
- Added a builtin-registry-wide `fboundp` parity checker against GNU Emacs `-Q`:
  - `test/neovm/vm-compat/check-builtin-registry-fboundp.sh`
  - allowlist: `test/neovm/vm-compat/cases/builtin-registry-fboundp-allowlist.txt`
- Added `make` target:
  - `make -C test/neovm/vm-compat check-builtin-registry-fboundp`
- Wired the parity gate into CI:
  - `.github/workflows/vm-compat.yml`
- Documented the gate in:
  - `test/neovm/vm-compat/README.md`
  - `docs/elisp-vm-design.md`
- Removed multiple unexposed/stale builtin implementations to keep dispatch surface aligned with the registry and oracle policy:
  - `custom-group-p` implementation cleanup
  - `selected-terminal` implementation cleanup
  - `display-line-numbers-update-width` implementation cleanup
  - `register-to-string` implementation cleanup
  - `extract-rectangle-line` implementation cleanup
  - removed stale misc stubs superseded by evaluator paths
  - removed unexposed bookmark helper builtin implementations
  - removed unexposed `string-repeat` helper implementation
  - removed unexposed `bool-vector-complement` implementation
  - removed unexposed `base64url-decode-string` helper
  - removed unexposed `hash-table-keys` / `hash-table-values` helpers
  - removed unexposed `downcase-char` helper
  - removed unexposed `find-coding-system` helper
  - removed unexposed `word-at-point` helper
  - removed stale, unreferenced `elisp/terminal` shim module files
  - removed stale, unreferenced pure-JSON buffer stub helpers from `elisp/json.rs` (`json-insert`/`json-parse-buffer`; replaced by active evaluator-backed implementations in the JSON module)
  - removed duplicate legacy JSON parser/serializer + tests from `elisp/cl_lib.rs` so `elisp/json.rs` is the single JSON implementation path
- Implemented `terminal-parameter` / `set-terminal-parameter` compatibility semantics:
  - persisted terminal parameter values for symbol keys
  - `terminal-parameter` enforces `symbolp` for PARAMETER
  - `set-terminal-parameter` returns `nil` (and ignores non-symbol keys)
  - invalid terminal designators now signal `wrong-type-argument` with `terminal-live-p`
  - `terminal-live-p` now returns `nil` for invalid designator shapes
  - `terminal-name` now rejects invalid terminal designators
  - switched terminal designators to an opaque internal terminal handle
  - `frame-terminal` now rejects invalid frame designators (`wrong-type-argument` on non-nil non-frame)
- Added and enabled new oracle corpus:
  - `test/neovm/vm-compat/cases/terminal-parameter-semantics.forms`
  - `test/neovm/vm-compat/cases/terminal-parameter-semantics.expected.tsv`
  - wired into `test/neovm/vm-compat/cases/default.list`
- Implemented `safe-date-to-time` compatibility subset:
  - parse and convert explicit-offset date formats (ISO/slash and RFC-style)
  - return `(HIGH LOW)` for valid dates, integer `0` for non-parseable/non-string inputs
  - preserve wrong-arity signaling
- Added and enabled new oracle corpus:
  - `test/neovm/vm-compat/cases/safe-date-to-time-semantics.forms`
  - `test/neovm/vm-compat/cases/safe-date-to-time-semantics.expected.tsv`
  - wired into `test/neovm/vm-compat/cases/default.list`
- Implemented `set-time-zone-rule` / `current-time-zone` compatibility subset:
  - process-level time zone rule state (`nil`/`wall`, `t`, integer offsets, TZ strings)
  - deterministic offset-name rendering for fixed offset rules
  - invalid specification signaling (`error "Invalid time zone specification"`)
  - `current-time-zone` now honors explicit `ZONE` argument overrides
- Added and enabled new oracle corpus:
  - `test/neovm/vm-compat/cases/time-zone-rule-semantics.forms`
  - `test/neovm/vm-compat/cases/time-zone-rule-semantics.expected.tsv`
  - wired into `test/neovm/vm-compat/cases/default.list`
- Implemented JSON compatibility adjustments:
  - `json-serialize` alist key typing now follows Emacs `symbolp` expectations
  - `json-parse-string` `:object-type 'alist` now emits symbol keys
  - parser now signals `json-end-of-file` for empty/whitespace-only input
  - trailing-content signal now uses `json-trailing-content`
- Added and enabled new oracle corpus:
  - `test/neovm/vm-compat/cases/json-semantics.forms`
  - `test/neovm/vm-compat/cases/json-semantics.expected.tsv`
  - wired into `test/neovm/vm-compat/cases/default.list`
- Aligned evaluator-backed buffer JSON builtins with Emacs behavior:
  - `json-parse-buffer` now parses from current point, allows trailing content, and advances point to the end of parsed value
  - `json-insert` now uses `json-serialize` keyword semantics (`:null-object`, `:false-object`)
  - dispatch for `json-parse-buffer` / `json-insert` now routes to `elisp/json.rs` implementations
- Aligned JSON keyword-argument error semantics with Emacs:
  - odd JSON plist tails now signal `(wrong-type-argument plistp ...)`
  - unknown JSON keyword args now signal `error` with Emacs-compatible message + offending value payload
  - invalid `:array-type` / `:object-type` values now signal Emacs-compatible `error` payloads
- Aligned display query builtins with Emacs batch-context defaults:
  - display queries now report terminal-style values in vm-compat context (`display-graphic-p`, `display-color-p`, pixel/mm size, color cells/planes/class/backing store, `x-display-list`)
  - preserved terminal-handle parameter semantics separately (`terminal-parameter` corpus remains green)
- Aligned terminal handle and terminal-name presentation semantics:
  - `terminal-name` now returns `\"initial_terminal\"` for the current terminal
  - `prin1-to-string` / `format` / error-message rendering now print terminal handles as `#<terminal ...>` (parity with GNU Emacs handle style)
- Added and enabled new oracle corpus:
  - `test/neovm/vm-compat/cases/json-buffer-semantics.forms`
  - `test/neovm/vm-compat/cases/json-buffer-semantics.expected.tsv`
  - wired into `test/neovm/vm-compat/cases/default.list`
- Added and enabled new oracle corpus:
  - `test/neovm/vm-compat/cases/json-keyword-errors.forms`
  - `test/neovm/vm-compat/cases/json-keyword-errors.expected.tsv`
  - wired into `test/neovm/vm-compat/cases/default.list`
- Added and enabled new oracle corpus:
  - `test/neovm/vm-compat/cases/display-batch-semantics.forms`
  - `test/neovm/vm-compat/cases/display-batch-semantics.expected.tsv`
  - wired into `test/neovm/vm-compat/cases/default.list`
- Added and enabled new oracle corpus:
  - `test/neovm/vm-compat/cases/terminal-handle-printing.forms`
  - `test/neovm/vm-compat/cases/terminal-handle-printing.expected.tsv`
  - wired into `test/neovm/vm-compat/cases/default.list`
- Aligned monitor attribute builtins with batch-style oracle semantics:
  - `display-monitor-attributes-list` / `frame-monitor-attributes` now return batch-size geometry/workarea `(0 0 80 25)`, `mm-size` as `(nil nil)`, and stable key shape (`geometry`, `workarea`, `mm-size`, `frames`)
  - invalid non-`nil` monitor designators now signal `error` (oracle-aligned class for `get-device-terminal` argument failures)
  - `frame-monitor-attributes` accepts terminal handles for terminal-associated monitor lookup semantics
- Added and enabled new oracle corpus:
  - `test/neovm/vm-compat/cases/display-monitor-semantics.forms`
  - `test/neovm/vm-compat/cases/display-monitor-semantics.expected.tsv`
  - wired into `test/neovm/vm-compat/cases/default.list`
- Aligned generic value printer with terminal-handle rendering:
  - top-level/result printing now renders terminal handles as `#<terminal ...>` instead of raw vector internals
  - byte-printing path (`print_value_bytes`) now mirrors the same terminal-handle representation
- Expanded oracle corpus for terminal-handle top-level rendering:
  - `test/neovm/vm-compat/cases/terminal-handle-printing.forms` now includes raw `(frame-terminal)` / `(car (terminal-list))` output checks
  - refreshed `test/neovm/vm-compat/cases/terminal-handle-printing.expected.tsv`
- Aligned batch frame introspection bootstrap semantics:
  - `selected-frame` / `frame-list` now synthesize the initial `F1` frame lazily when no frame exists yet in evaluator state
  - keeps batch introspection paths (`framep`, `frame-live-p`, `frame-list` membership) oracle-aligned without requiring editor-side frame bootstrap
- Added and enabled new oracle corpus:
  - `test/neovm/vm-compat/cases/frame-batch-semantics.forms`
  - `test/neovm/vm-compat/cases/frame-batch-semantics.expected.tsv`
  - wired into `test/neovm/vm-compat/cases/default.list`
- Aligned monitor `frames` slot with live evaluator frame set:
  - added evaluator-aware monitor dispatch so `display-monitor-attributes-list` / `frame-monitor-attributes` populate `frames` from `frame-list`
  - monitor queries now bootstrap and expose one live frame in batch mode (matching oracle shape expectations)
- Added and enabled new oracle corpus:
  - `test/neovm/vm-compat/cases/display-monitor-frames-semantics.forms`
  - `test/neovm/vm-compat/cases/display-monitor-frames-semantics.expected.tsv`
  - wired into `test/neovm/vm-compat/cases/default.list`
- Aligned internal face introspection builtins with oracle semantics:
  - `internal-lisp-face-p` now returns face vectors for known faces, `nil` for unknown/non-face inputs, and validates optional frame designators (`frame-live-p` payload)
  - `internal-get-lisp-face-attribute` now validates optional frame argument (`nil`/`t` or live-frame type check), validates face/attribute error payloads, and returns oracle-compatible values for core faces in batch mode
  - added oracle corpus:
    - `test/neovm/vm-compat/cases/internal-lisp-face-semantics.forms`
    - `test/neovm/vm-compat/cases/internal-lisp-face-semantics.expected.tsv`
    - enabled in `test/neovm/vm-compat/cases/default.list`
  - verified:
    - `cargo test font::tests -- --nocapture` (pass)
    - `make -C test/neovm/vm-compat check-neovm FORMS=cases/internal-lisp-face-semantics.forms EXPECTED=cases/internal-lisp-face-semantics.expected.tsv` (pass)
    - `make -C test/neovm/vm-compat validate-case-lists` (pass)
- Aligned additional internal face builtins with oracle semantics:
  - implemented and registered `internal-lisp-face-attribute-values`, `internal-lisp-face-empty-p`, and `internal-lisp-face-equal-p`
  - `internal-lisp-face-attribute-values` now returns `(t nil)` for discrete boolean face attributes and preserves symbol/type/arity error semantics
  - `internal-lisp-face-empty-p` / `internal-lisp-face-equal-p` now validate frame argument shape first, resolve face designators (symbol/string) with oracle-compatible invalid-face payloads, and honor `FRAME=t` default-face behavior
  - expanded core built-in face attribute map used by comparisons (`highlight`/`region`/`mode-line` inverse-video, `mode-line-inactive` inherit, `fringe` background, `cursor` background)
  - added oracle corpus:
    - `test/neovm/vm-compat/cases/internal-lisp-face-comparators.forms`
    - `test/neovm/vm-compat/cases/internal-lisp-face-comparators.expected.tsv`
    - enabled in `test/neovm/vm-compat/cases/default.list`
  - verified:
    - `cargo test font::tests -- --nocapture` (pass)
    - `make -C test/neovm/vm-compat check-neovm FORMS=cases/internal-lisp-face-comparators.forms EXPECTED=cases/internal-lisp-face-comparators.expected.tsv` (pass)
    - `make -C test/neovm/vm-compat validate-case-lists` (pass)
    - `NEOVM_ORACLE_EMACS=/nix/store/hql3zwz5b4ywd2qwx8jssp4dyb7nx4cb-emacs-30.2/bin/emacs make -C test/neovm/vm-compat check-builtin-registry-fboundp` (pass; expected allowlisted drift only)
- Added deep matrix oracle lock-in for `internal-get-lisp-face-attribute`:
  - new corpus covers full core-face x attribute matrix in selected-frame mode plus defaults-frame (`FRAME=t`) sampling and error/arity payloads
  - added:
    - `test/neovm/vm-compat/cases/internal-get-lisp-face-attribute-matrix.forms`
    - `test/neovm/vm-compat/cases/internal-get-lisp-face-attribute-matrix.expected.tsv`
    - enabled in `test/neovm/vm-compat/cases/default.list`
  - verified:
    - `make -C test/neovm/vm-compat check-neovm FORMS=cases/internal-get-lisp-face-attribute-matrix.forms EXPECTED=cases/internal-get-lisp-face-attribute-matrix.expected.tsv` (pass, 271/271)
    - `make -C test/neovm/vm-compat validate-case-lists` (pass)
- Aligned and locked-in make/copy Lisp face helper semantics:
  - registered `internal-make-lisp-face` in NeoVM builtin dispatch/registry and implemented Oracle-compatible argument checks and frame error payloads
  - updated `internal-copy-lisp-face` to match Oracle ordering and behavior: symbol checks first, `FRAME=t` fast-path, non-`t` frame `wrong-type-argument` payloads, source-face validity checks, and destination face visibility via `internal-lisp-face-p`
  - wired created-face visibility state so faces created via `internal-make-lisp-face` / `internal-copy-lisp-face` are discoverable by `internal-lisp-face-p` (without broadening `internal-get-lisp-face-attribute` validity surface)
  - added oracle corpus:
    - `test/neovm/vm-compat/cases/internal-make-copy-lisp-face-semantics.forms`
    - `test/neovm/vm-compat/cases/internal-make-copy-lisp-face-semantics.expected.tsv`
    - enabled in `test/neovm/vm-compat/cases/default.list`
  - verified:
    - `cargo test font::tests -- --nocapture` (pass)
    - `make -C test/neovm/vm-compat check-neovm FORMS=cases/internal-lisp-face-semantics.forms EXPECTED=cases/internal-lisp-face-semantics.expected.tsv` (pass)
    - `make -C test/neovm/vm-compat check-neovm FORMS=cases/internal-lisp-face-comparators.forms EXPECTED=cases/internal-lisp-face-comparators.expected.tsv` (pass)
    - `make -C test/neovm/vm-compat check-neovm FORMS=cases/internal-make-copy-lisp-face-semantics.forms EXPECTED=cases/internal-make-copy-lisp-face-semantics.expected.tsv` (pass, 42/42)
    - `make -C test/neovm/vm-compat validate-case-lists` (pass)
    - `NEOVM_ORACLE_EMACS=/nix/store/hql3zwz5b4ywd2qwx8jssp4dyb7nx4cb-emacs-30.2/bin/emacs make -C test/neovm/vm-compat check-builtin-registry-fboundp` (pass; expected allowlisted drift only)
- Kept branch green with targeted Rust tests and vm-compat checks after each slice.

## Doing

- Continue compatibility-first maintenance with small commit slices:
  - keep builtin surface and registry in lock-step
  - run oracle/parity checks after each behavior-affecting change
  - remove dead helper code that is not part of exposed compatibility surface
- Reduce vm-compat operator friction for large case sets (small Makefile UX improvements).
  - added list-driven targets: `record-list`, `check-list`, `check-neovm-list` with `LIST=cases/<name>.list`

## Next

1. Run a full vm-compat verification pass (`check-all-neovm`) after the latest cleanup batch and record results.
2. Expand focused oracle corpora for remaining high-risk areas still carrying stubs (search/input/minibuffer/display edges).
3. Prioritize one high-impact stub-to-real implementation slice with oracle lock-in, then repeat.
4. Keep Rust backend behind compile-time switch and preserve Emacs C core as default backend.
